<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="de" xml:lang="de">
<head>
<!-- 2021-10-01 Fr 18:08 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ansible Playbooks für yaVDR</title>
<meta name="author" content="Alexander Grothe (seahawk1986)" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
</style>
<link rel="stylesheet" type="text/css" href="src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="src/readtheorg_theme/css/readtheorg.css"/>
<script type="text/javascript" src="src/lib/js/jquery.min.js"></script>
<script type="text/javascript" src="src/lib/js/bootstrap.min.js"></script>
<script type="text/javascript" src="src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="src/readtheorg_theme/js/readtheorg.js"></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Ansible Playbooks für yaVDR</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Inhaltsverzeichnis</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#einleitung">Einleitung</a>
<ul>
<li><a href="#lizenz">Lizenz</a></li>
<li><a href="#vorwort">Vorwort</a></li>
<li><a href="#zur-syntax">Zur Syntax</a></li>
</ul>
</li>
<li><a href="#installation">1. Installation</a>
<ul>
<li><a href="#system-requirements">1.1. Systemvoraussetzungen</a>
<ul>
<li><a href="#org1ba245c">1.1.1. für die Nutzung als HTPC</a></li>
<li><a href="#org55f5a14">1.1.2. Nutzung als Server</a></li>
</ul>
</li>
<li><a href="#ubuntu-installation">1.2. Installation des Basissystems</a>
<ul>
<li><a href="#iso-download">1.2.1. Download des Ubuntu Server ISO</a></li>
<li><a href="#ubuntu-server-install">1.2.2. <span class="todo TODO">TODO</span> Installation von Ubuntu Server</a></li>
</ul>
</li>
<li><a href="#ansible-installation">1.3. Installation von yaVDR mit Ansible</a>
<ul>
<li><a href="#playbook-git">1.3.1. Herunterladen von yavdr-ansible</a></li>
<li><a href="#org8858fbc">1.3.2. Anpassen der Vorkonfiguration</a></li>
<li><a href="#install-scripts">1.3.3. Ausführen der Installationsskripte</a></li>
</ul>
</li>
<li><a href="#first-steps">1.4. Erste Schritte nach der Installation</a>
<ul>
<li><a href="#channel-list">1.4.1. Kanalliste hinterlegen</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#system-basics">2. Grundlegendes zum System</a>
<ul>
<li><a href="#ssh">2.1. SSH</a></li>
<li><a href="#root-permissions">2.2. Mit erhöhten Rechten Arbeiten</a></li>
<li><a href="#editors">2.3. Editoren</a></li>
<li><a href="#package-management">2.4. Paketverwaltung</a>
<ul>
<li><a href="#apt-updates">2.4.1. Updates Einspielen</a></li>
<li><a href="#orgd25d991">2.4.2. Entfernen ungenutzter Pakete und alter Kernel</a></li>
</ul>
</li>
<li><a href="#systemd-services">2.5. Dienste</a>
<ul>
<li><a href="#systemctl">2.5.1. systemctl</a></li>
</ul>
</li>
<li><a href="#logfiles">2.6. Logdateien</a></li>
<li><a href="#audio-output">2.7. Audioausgabe</a>
<ul>
<li><a href="#org415ea7f">2.7.1. Pulseaudio vorübergehend deaktivieren</a></li>
<li><a href="#pulse-disable-permanently">2.7.2. Pulseaudio komplett deaktivieren</a></li>
<li><a href="#pulse-force-alsa">2.7.3. Pulseaudio Nutzung von Alsa-Gerät erzwingen</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#remotes">3. Fernbedienungen</a>
<ul>
<li><a href="#yavdr-namespace">3.1. Vereinheitlichtes Schema für Tastennamen</a></li>
<li><a href="#ir-keytable">3.2. ir-keytable</a>
<ul>
<li><a href="#ir-keytable-customization">3.2.1. Anpassen der Tastenbelegung für rc-core Empfänger</a></li>
</ul>
</li>
<li><a href="#lircd2uinput">3.3. lircd2uinput</a></li>
<li><a href="#eventlircd">3.4. eventlircd</a>
<ul>
<li><a href="#eventlircd-specialities">3.4.1. Besonderheiten für eventlircd</a></li>
</ul>
</li>
<li><a href="#lircd">3.5. lircd</a></li>
<li><a href="#debug-remote">3.6. Tools zum Debuggen von Tastendrücken</a>
<ul>
<li><a href="#evtest">3.6.1. evtest</a></li>
<li><a href="#ir-keytable-test">3.6.2. ir-keytable</a></li>
<li><a href="#irw">3.6.3. irw</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#network-services">4. Netzwerkdienste</a>
<ul>
<li><a href="#network-shares">4.1. Netzwerkfreigaben</a>
<ul>
<li><a href="#avahi-linker">4.1.1. avahi-linker</a></li>
</ul>
</li>
<li><a href="#nfs-server">4.2. NFS</a></li>
<li><a href="#samba-server">4.3. Samba</a></li>
</ul>
</li>
<li><a href="#xorg-output">5. Ausgabe mit Xorg</a>
<ul>
<li><a href="#org436730f">5.1. Zugriff auf die Systemd User Session</a>
<ul>
<li><a href="#systemctl-user-session">5.1.1. Einzelne Befehl mit passenden Rechten und Umgebungsvariablen absetzen:</a></li>
<li><a href="#tmux-user-session">5.1.2. Zugriff mit tmux</a></li>
</ul>
</li>
<li><a href="#yavdr-frontend">5.2. yavdr-frontend</a>
<ul>
<li><a href="#org784507a">5.2.1. Verhalten beim Start</a></li>
</ul>
</li>
<li><a href="#start-programs">5.3. Programme starten</a>
<ul>
<li><a href="#orgfb5fd36">5.3.1. desktop-Plugin</a></li>
<li><a href="#frontend-dbus-send">5.3.2. frontend-dbus-send</a></li>
</ul>
</li>
<li><a href="#dual-screen">5.4. Mehrere Bildschirme</a>
<ul>
<li><a href="#osd2web-dualscreen">5.4.1. osd2web auf zweitem Monitor</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#vdr">6. VDR</a>
<ul>
<li><a href="#vdr-controls">6.1. Bedienung des VDR</a></li>
<li><a href="#vdr-output-plugins">6.2. Unterstützte Ausgabeplugins</a>
<ul>
<li><a href="#org1491957">6.2.1. Bekannte Probleme bei den Ausgabeplugins:</a></li>
</ul>
</li>
<li><a href="#vdr-configuration">6.3. Konfiguration des VDR</a>
<ul>
<li><a href="#vdr-environment-variables">6.3.1. Umgebungsvariablen</a></li>
<li><a href="#vdr-start-arguments">6.3.2. Startargumente</a></li>
<li><a href="#vdr-shutdown">6.3.3. Shutdown</a></li>
<li><a href="#vdr-common-problems">6.3.4. Häufige Problemstellungen</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgbd4f108">7. KODI</a>
<ul>
<li>
<ul>
<li><a href="#orgd353696">7.0.1. Fernsehen mit VNSI</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#epgd">8. vdr-epg-daemon</a>
<ul>
<li><a href="#org69d52ee">8.1. Häufige Probleme</a>
<ul>
<li><a href="#org087c8e5">8.1.1. epgd startet nicht</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sundtek-drivers">9. Sundtek Treiber</a>
<ul>
<li><a href="#sundtek-delay-vdr-start">9.1. Start des VDR verzögern, bis alle Tuner initialisiert wurden</a></li>
<li><a href="#sundtek-dynamic-includes">9.2. Sundtek-Tuner automatisch zur Laufzeit des VDR einbinden lassen</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-einleitung" class="outline-2">
<h2 id="einleitung">Einleitung</h2>
<div class="outline-text-2" id="text-einleitung">
</div>
<div id="outline-container-lizenz" class="outline-3">
<h3 id="lizenz">Lizenz</h3>
<div class="outline-text-3" id="text-lizenz">
<p>
Dieses Dokument steht unter der <a href="http://www.gnu.org/licenses/fdl-1.3.txt">GNU FDL</a>
</p>
</div>
</div>
<div id="outline-container-vorwort" class="outline-3">
<h3 id="vorwort">Vorwort</h3>
<div class="outline-text-3" id="text-vorwort">
<p>
yaVDR (yet another VDR) ist eine für die Nutzung des <a href="http://www.tvdr.de/">Video Disk Recorder</a> von Klaus Schmidinger angepasste Distribution auf der Basis von Ubuntu Linux, das mit Paketen aus eigenen Paketquellen erweitert wird, um die Nutzung aktueller Versionen des VDR, von KODI und anderer erforderlicher Pakete zu ermöglichen.
</p>

<p>
Der VDR ist dafür ausgelegt, digitales Fernsehen über die gängigen Empfangswege (DVB-S2, DVB-T(2), DVB-C) zu empfangen, aufzuzeichnen, zu schneiden und wiederzugeben. Mit mit dem <a href="http://www.vdr-wiki.de/wiki/index.php/Pvrinput-plugin">pvrinput-Plugin</a> und einer passenden Hauppauge-TV Karte mit MPEG2-Hardware&#x00ad;encoder ist der Empfang von analog-TV möglich.
Mit KODI ist außerdem ein mächtiges MediaCenter integriert, das es ermöglicht einen PC mit yaVDR als <a href="https://de.wikipedia.org/wiki/Home_Theater_Personal_Computer">HTPC</a> zu nutzen.
Um eine lange Versorgung mit sicherheitsrelevanten Updates zu ermöglichen, baut yaVDR nach Möglichkeit auf <a href="https://wiki.ubuntuusers.de/Long_Term_Support/">LTS Versionen von Ubuntu</a> auf.
</p>

<p>
Bei der Installation wird unterstützte Hardware automatisch erkannt und die notwendigen Pakete installiert und vorkonfiguriert, um dem Nutzer eine schnelle Inbetriebnahme des Systems zu ermöglichen. Da dieser Teil der Installation als Ansible-Playbook realisiert ist, kann die Vorkonfiguration bequem erweitert und angepasst werden.
</p>

<p>
Diese Dokumentation soll die Installation, Konfiguration und Bedienung eines yaVDR Systems erklären und dem Nutzer dabei helfen, sich mit den Besonderheiten vertraut zu machen, die eine yaVDR-Installation von einer normalen Ubuntu-Installation unterscheiden.
Es ist bewusst keine Einführung in die Grundlagen der Bedienung von (Ubuntu) Linux.
Daher wird dem Neueinsteiger empfohlen sich mit Hilfe von entsprechender Literatur oder Online-Quellen wie dem sehr umfangreichen <a href="http://wiki.ubuntuusers.de">Ubuntu Users Wiki</a> einzulesen. Die <a href="https://freedesktop.org/wiki/Software/systemd/">Dokumentation für systemd</a> kann hilfreich sein, um die Funktionsweise der von yavdr-ansible eingerichteten Dienste nachvollziehen zu können.
Auch für den VDR und für KODI kann an dieser Stelle nicht jedes Detail erklärt werden - gute Anlaufstellen für weiterführende Informationen sind das <a href="http://vdr-wiki.de/">VDR-Wiki</a> und das <a href="http://kodi.wiki/view/Main_Page">KODI-Wiki</a>.
Wann immer die Beschreibung von Befehlen, Funktionen oder Abläufen den Rahmen dieser Dokumentation sprengen würde, wird daher auf weiterführendes Material verlinkt. Auch Doppelungen werden nach Möglichkeit vermieden und stattdessen auf die entsprechende Stelle in der Dokumentation verlinkt.
</p>
</div>
</div>
<div id="outline-container-zur-syntax" class="outline-3">
<h3 id="zur-syntax">Zur Syntax</h3>
<div class="outline-text-3" id="text-zur-syntax">
<p>
Befehle, die man in der Shell ausführen kann, sehen so aus:
</p>
<pre class="example" id="orgb2a2620">
$ echo "Hallo, Welt!"
Hallo, Welt!
$ sudo -i  # erlange eine root-Shell
# whoami
root
</pre>
<p>
Ein <code>$</code> ist dabei der Prompt für einen normalen Nutzer (wie er bei der Installation angelegt wurde) und ein <code>#</code> der Prompt für den Benutzer <b>root</b>. Der Prompt wird nicht mit eingegeben, um einen Befehl auszuführen. In dem Fall würde man also <code>echo "Hallo, Welt!"</code> eingeben. Die Ausgaben des Befehl erscheinen vor dem nächsten Prompt (in dem Fall in Zeile 2 und 5)
</p>

<p>
Code im Dokument wird nach Möglichkeit mit Syntax-Highlighting dargestellt, also z.B.:
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="org-comment-delimiter">#</span><span class="org-comment">!/usr/bin/env python3</span>
<span class="org-keyword">print</span>(<span class="org-string">"Hallo, Welt"</span>)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-installation" class="outline-2">
<h2 id="installation"><span class="section-number-2">1.</span> Installation</h2>
<div class="outline-text-2" id="text-installation">
</div>
<div id="outline-container-system-requirements" class="outline-3">
<h3 id="system-requirements"><span class="section-number-3">1.1.</span> Systemvoraussetzungen</h3>
<div class="outline-text-3" id="text-system-requirements">
<ul class="org-ul">
<li>Eine von Ubuntu unterstützte x86-kompatible CPU (muss aktuell mindestens i686 kompatibel sein). Falls von der CPU unterstützt, wird eine 64-Bit Installation empfohlen.  32-Bit Installationen wurden nicht getestet.</li>
<li>Für die Root-Partition (<code>/</code>) werden mindestens 8 GB empfohlen, bei einer großen Mediensammlung mit KODI mindestens 32 GB. Eine SSD für die Systempartition kann die Boot-Zeit spürbar verringern.</li>
<li>Eine swap-Partition wird bei mehr als 2 GB Arbeitsspeicher nicht zwingend benötigt. Sie sollte mindestens so groß wie der Arbeitsspeicher sein, um den Ruhezustand nutzen zu können.</li>
<li>Der Mountpoint für <code>/srv</code> sollte eine eigene Partition bekommen. Da für Aufnahmen von SD-TV bis zu ca. 3 GB/s und für HD-TV bis zu 9 GB pro Stunde an Daten geschrieben werden können, sollte sie ausreichend dimensioniert werden. Falls Aufnahmen und andere Medien gesammelt werden, ist eine Platte mit einer Größe von mehr als einem Terabyte sinnvoll.</li>
</ul>
</div>
<div id="outline-container-org1ba245c" class="outline-4">
<h4 id="org1ba245c"><span class="section-number-4">1.1.1.</span> für die Nutzung als HTPC</h4>
<div class="outline-text-4" id="text-1-1-1">
<p>
yaVDR 0.7 ist für die Nutzung mit VDPAU-fähigen NVidia-Grafikkarten und Intel IGPs ausgelegt. Für eine experimentelle Unterstützung für Grafikkarten von AMD werden Tester mit geeigneter Hardware gesucht.
</p>
</div>
</div>
<div id="outline-container-org55f5a14" class="outline-4">
<h4 id="org55f5a14"><span class="section-number-4">1.1.2.</span> Nutzung als Server</h4>
<div class="outline-text-4" id="text-1-1-2">
<p>
Ab yaVDR 0.7 besteht die Möglichkeit auf die Installation der GUI-Komponenten zu verzichten und es als Backend-Server zu betreiben.
In dem Fall wird keine Grafikkarte für die hardwarebeschleunigte Ausgabe benötigt. In Verbindung mit einem Sat&gt;IP Server könnte man den Server in einer Virtuellen Maschine betreiben.
</p>
</div>
</div>
</div>
<div id="outline-container-ubuntu-installation" class="outline-3">
<h3 id="ubuntu-installation"><span class="section-number-3">1.2.</span> Installation des Basissystems</h3>
<div class="outline-text-3" id="text-ubuntu-installation">
<p>
Da es in der Vergangenheit immer wieder Kompatibilitätsprobleme durch die angepassten yaVDR Installation-Images gab, gehen wir bei yaVDR 0.7 einen anderen Weg:
</p>

<p>
Zunächst wird eine Ubuntu Server Installation (wichtig: bei Ubuntu 18.04 die ISOs für den alternative Ubuntu Server Installer nutzen, damit Bootsplash, X-Server und Abhängigkeiten zu bestehenden Netzwerkverbindungen korrekt funktionieren und nicht durch das cloud-init Paket aus dem Tritt gebracht werden) durchgeführt, bei der der Nutzer beliebige Point-Releases (und damit neuere Kernel) wählen kann. Danach besteht die Möglichkeit zusätzliche Treiber zu installieren und die Netzwerkverbindung zu konfigurieren.
</p>

<p>
Nachdem die Grundinstallation abgeschlossen wurde, wird mit Hilfe von <a href="https://docs.ansible.com/ansible/latest/index.html">Ansible</a> das System als yaVDR-Installation konfiguriert. Der interessierte Nutzer hat die Möglichkeit die Installationsskripte selbst anzupassen - damit wird es deutlich leichter zusätzliche Paketquellen einzubinden und das System reproduzierbar auf die eigenen Bedürfnisse angepasst vorkonfigurieren zu lassen.
</p>
</div>

<div id="outline-container-iso-download" class="outline-4">
<h4 id="iso-download"><span class="section-number-4">1.2.1.</span> Download des Ubuntu Server ISO</h4>
<div class="outline-text-4" id="text-iso-download">
<p>
Das Installations-ISO für den Ubuntu Server 20.04 kann von der offiziellen Ubuntu-Webseite heruntergeladen werden: <a href="https://releases.ubuntu.com/20.04/">https://releases.ubuntu.com/20.04/</a> 
</p>

<p>
Das ISO lässt sich auf eine DVD brennen (für normale CD-Rohlinge ist das Image zu groß) oder mit einem Tool wie <a href="https://wiki.ubuntuusers.de/dd/#Live-USB-Stick-erstellen">dd</a> auf einen USB-Stick schreiben. Ein Netboot ist ebenfalls möglich:  <a href="https://discourse.ubuntu.com/t/netbooting-the-live-server-installer/14510">https://discourse.ubuntu.com/t/netbooting-the-live-server-installer/14510</a>
</p>

<p>
Ubuntu Server 18.04 wird mit Einschränkungen unterstützt (es sollte dabei unbedingt der klassische Installer genutzt werden) und spiegelt im Wesentlichen einen früheren Entwicklungsstand wieder.
</p>
</div>
</div>
<div id="outline-container-ubuntu-server-install" class="outline-4">
<h4 id="ubuntu-server-install"><span class="section-number-4">1.2.2.</span> <span class="todo TODO">TODO</span> Installation von Ubuntu Server</h4>
<div class="outline-text-4" id="text-ubuntu-server-install">
</div>
</div>
</div>

<div id="outline-container-ansible-installation" class="outline-3">
<h3 id="ansible-installation"><span class="section-number-3">1.3.</span> Installation von yaVDR mit Ansible</h3>
<div class="outline-text-3" id="text-ansible-installation">
</div>
<div id="outline-container-playbook-git" class="outline-4">
<h4 id="playbook-git"><span class="section-number-4">1.3.1.</span> Herunterladen von yavdr-ansible</h4>
<div class="outline-text-4" id="text-playbook-git">
<p>
Die Ansible-Playbook-Sammlung für yaVDR kann so heruntergeladen werden:
</p>
<div class="org-src-container">
<pre class="src src-text">$ sudo apt install git
$ git clone https://github.com/yavdr/yavdr-ansible
$ cd yavdr-ansible
</pre>
</div>

<p>
Die Dateien für Ubuntu 20.04 befinden sich im Zweig <code>focal</code>, der automatisch aktiv sein sollte (kann man z.B. mit <code>git status</code> überprüfen), die Dateien für Ubuntu 18.04 befinden sich im Branch <code>bionic</code>. Um gezielt zu dem Branch zu wechseln kann man den Befehl <code>git checkout bionic</code> nutzen.
</p>

<p>
Um später den aktuellsten Stand für den aktuell aktiven Branch aus den Repository zu holen, kann man den Befehl <code>git pull</code> nutzen.
</p>
</div>
</div>
<div id="outline-container-org8858fbc" class="outline-4">
<h4 id="org8858fbc"><span class="section-number-4">1.3.2.</span> Anpassen der Vorkonfiguration</h4>
<div class="outline-text-4" id="text-1-3-2">
<p>
Interessierte Nutzer haben die Möglichkeit die von yavdr-ansible umgesetzte Systemkonfiguration auf die eigenen Vorlieben und Gegebenheiten anzupassen.
</p>

<p>
Nicht benötigte Rollen können im Playbook (<code>yavdr07.yml</code> bzw. <code>yavdr07-headless.yml</code>) auskommentiert werden und Rollen, die keine automatische Hardwareerkennung nutzen (wie z.B. <code>serial-ir</code> und <code>epgd)</code> können bei Bedarf aktiviert werden.
</p>

<p>
Um in <code>group_vars/all</code> definierte Variablen anzupassen, sollte man eine Datei <code>host_vars/localhost</code> anlegen und darin die gewünschten Anpassungen vornehmen. Die in dieser Datei definierten Variablen übersteuern die Vorgabewerte aus dem Playbook und der <code>group_vars/all</code>.
</p>
</div>

<ol class="org-ol">
<li><a id="org550d0f1"></a>genutzte PPAs<br />
<div class="outline-text-5" id="text-1-3-2-1">
<p>
Statt der in der <code>groups_vars/all</code> vorgegebenen PPAs können beliebige Paketquellen genutzt werden (solange diese die benötigten Pakete enthalten).
</p>

<p>
Standardmäßig werden die PPAs  <code>ppa:yavdr/experimentai-main</code>, <code>ppa:yavdr/experimental-vdr</code> sowie <code>ppa:yavdr/experimental-kodi</code> genutzt:
</p>
<div class="org-src-container">
<pre class="src src-yaml"><span class="org-variable-name">branch</span>: experimental
<span class="org-variable-name">ppa_owner</span>: <span class="org-string">'ppa:yavdr'</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">add the following PPAs</span>
<span class="org-variable-name">repositories</span>:
  - <span class="org-string">'</span><span class="org-builtin">{{</span><span class="org-function-name"> ppa_owner </span><span class="org-builtin">}}</span><span class="org-string">/</span><span class="org-builtin">{{</span><span class="org-function-name">branch</span><span class="org-builtin">}}</span><span class="org-string">-main'</span>
  - <span class="org-string">'</span><span class="org-builtin">{{</span><span class="org-function-name"> ppa_owner </span><span class="org-builtin">}}</span><span class="org-string">/</span><span class="org-builtin">{{</span><span class="org-function-name">branch</span><span class="org-builtin">}}</span><span class="org-string">-vdr'</span>
  - <span class="org-string">'</span><span class="org-builtin">{{</span><span class="org-function-name"> ppa_owner </span><span class="org-builtin">}}</span><span class="org-string">/</span><span class="org-builtin">{{</span><span class="org-function-name">branch</span><span class="org-builtin">}}</span><span class="org-string">-kodi'</span>
</pre>
</div>

<p>
Möchte man stattdessen z.B. ein PPA für den VDR 2.4.5 mit Patches für das dynamite-Plugin nutzen, könnte man in einer <code>host_vars/localhost</code> z.B. folgende Änderung vornehmen:
</p>
<div class="org-src-container">
<pre class="src src-yaml"><span class="org-variable-name">repositories</span>:
  - <span class="org-string">'</span><span class="org-builtin">{{</span><span class="org-function-name"> ppa_owner </span><span class="org-builtin">}}</span><span class="org-string">/</span><span class="org-builtin">{{</span><span class="org-function-name">branch</span><span class="org-builtin">}}</span><span class="org-string">-main'</span>
  - <span class="org-string">'ppa:seahawk1986-hotmail/vdr-2.4.5-patches'</span>
  - <span class="org-string">'</span><span class="org-builtin">{{</span><span class="org-function-name"> ppa_owner </span><span class="org-builtin">}}</span><span class="org-string">/</span><span class="org-builtin">{{</span><span class="org-function-name">branch</span><span class="org-builtin">}}</span><span class="org-string">-kodi'</span>
</pre>
</div>

<p>
Wichtig: Das Playbook entfernt einmal hinzugefügte Paketquellen nicht automatisch - man muss also immer dafür sorgen, dass nur die gewünschten Paketquellen aktiv sind. Das Entfernen von PPAs und den daraus installierten Paketen (ggf. mit Downgrade auf ältere Paketversionen) ist z.B. mit dem Tool <a href="https://wiki.ubuntuusers.de/Paketquellen_freischalten/PPA/#PPA-Purgehttps://wiki.ubuntuusers.de/Paketquellen_freischalten/PPA/%23PPA-Purge">ppa-purge</a> möglich.
</p>
</div>
</li>

<li><a id="org1fe262f"></a>Sprache und Zeitzone<br />
<div class="outline-text-5" id="text-1-3-2-2">
<p>
Da der Live-Installer für Ubuntu Server 20.04 die Locale- und Zeitzoneneinstellungen nicht mehr automatisch setzt, läuft ein frisch installiertes System in der Zeitzone UTC und mit der Locale <code>en_US.UTF-8</code>. Das Playbook setzt standardmäßig die Zeitzone <code>Europe/Berlin</code> und die Standard-Locale <code>de_DE.UTF-8</code>.
</p>

<p>
Diese Einstellungen können über die folgenden Variablen in der <code>=host_vars/localhost</code> angepasst werden - in der Voreinstellung sieht das so aus:
</p>
<div class="org-src-container">
<pre class="src src-yaml"><span class="org-variable-name">timezone</span>: <span class="org-string">'Europe/Berlin'</span>
<span class="org-variable-name">default_locale</span>: <span class="org-string">'de_DE.UTF-8'</span>
<span class="org-variable-name">generate_locales</span>:  <span class="org-comment-delimiter"># </span><span class="org-comment">see entries in /etc/locale.gen</span>
  - <span class="org-string">'de_DE.UTF-8 UTF-8'</span>
  - <span class="org-string">'en_US.UTF-8 UTF-8'</span>
<span class="org-variable-name">language_packs</span>:
  - language-pack-de
  - language-pack-en
</pre>
</div>
</div>
</li>
<li><a id="special-roles"></a>Spezielle Rollen<br />
<div class="outline-text-5" id="text-special-roles">
</div>
<ol class="org-ol">
<li><a id="serial-ir-role"></a>serial-ir<br />
<div class="outline-text-6" id="text-serial-ir-role">
<p>
Für serielle Empfänger (wie z.B. beim Atric V5) sollte im Playbook die Rolle <code>serial-ir</code> einkommentiert werden. Standardmäßig wird die erste serielle Schnittstelle genutzt (<code>/dev/ttyS0</code> aka COM1). Ist der Empfänger an der zweiten seriellen Schnittstelle angeschlossen, muss in der <code>host_vars/localhost</code> die Variable <code>serial_ir_device</code> entsprechend angepasst werden:
</p>
<div class="org-src-container">
<pre class="src src-yaml"><span class="org-variable-name">serial_ir_device</span>: ttyS1
</pre>
</div>
</div>
</li>
<li><a id="epgd-role"></a>epgd<br />
<div class="outline-text-6" id="text-epgd-role">
<p>
Wird diese Rolle im Playbook einkommentiert, richtet yavdr-ansible den vdr-epgd-daemon inkl. MariaDB-Datenbank ein und installiert das <code>vdr-plugin-epg2vdr</code>.
</p>
</div>
</li>
<li><a id="install-sundtek-role"></a>install-sundtek<br />
<div class="outline-text-6" id="text-install-sundtek-role">
<p>
Für Sundtek-Tuner sollte im Playbook die Rolle <code>install-sundtek</code> einkommentiert werden. Diese Rolle richtet die Sundtek-Treiber und eine <code>sundtek.service</code> ein.
</p>

<p>
Über die Konfiguration in der <code>host_vars/localhost</code> kann festgelegt werden, ob die Treiber auch installiert werden sollen, wenn kein lokal angeschlossener Stick erkannt wurde (<code>sundtek.force_install</code>) und ob der Start des VDR verzögert werden soll bis
</p>
<ul class="org-ul">
<li>lokal angeschlossene Sundtek-Tuner initialisiert wurden (<code>sundtek.wait_for_devices</code>) - falls das nicht auf <code>true</code> gesetzt wird, werden die Pakete <code>vdr-plugin-sundtek</code> und <code>vdr-plugin-dynamite</code> installiert</li>
<li>das Netzwerk verfügbar ist (<code>sundtek.wait_for_network</code>)</li>
</ul>

<div class="org-src-container">
<pre class="src src-yaml"><span class="org-variable-name">sundtek</span>:
  <span class="org-variable-name">force_install</span>: <span class="org-constant">false</span>
  <span class="org-variable-name">wait_for_devices</span>: <span class="org-constant">true</span>
  <span class="org-variable-name">wait_for_network</span>: <span class="org-constant">false</span>
</pre>
</div>
</div>
</li>
</ol>
</li>

<li><a id="jinja2-templates"></a>Templates<br />
<div class="outline-text-5" id="text-jinja2-templates">
<p>
Gegenüber früheren yaVDR-Versionen kommt eine neue Template-Engine (<a href="http://jinja.palletsprojects.com/">jinja2</a>) zum Einsatz. Templates werden beim Ausführen der im Playbook konfigurierten Rollen expandiert.
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-install-scripts" class="outline-4">
<h4 id="install-scripts"><span class="section-number-4">1.3.3.</span> Ausführen der Installationsskripte</h4>
<div class="outline-text-4" id="text-install-scripts">
<p>
Um yaVDR mit dem vorgegebenen Playbook einzurichten, ruft man danach folgenden Befehl auf:
</p>
<pre class="example" id="orga3a19a0">
$ sudo -H ./install-yavdr.sh
</pre>
<p>
Will man nur eine Server-Installation ohne GUI, ruft man dieses Skript auf:
</p>
<pre class="example" id="orgb16e09d">
$ sudo -H ./install-yavdr-headless.sh
</pre>
</div>
</div>
</div>

<div id="outline-container-first-steps" class="outline-3">
<h3 id="first-steps"><span class="section-number-3">1.4.</span> Erste Schritte nach der Installation</h3>
<div class="outline-text-3" id="text-first-steps">
</div>
<div id="outline-container-channel-list" class="outline-4">
<h4 id="channel-list"><span class="section-number-4">1.4.1.</span> Kanalliste hinterlegen</h4>
<div class="outline-text-4" id="text-channel-list">
<p>
Damit der VDR Sender empfangen kann, benötigt er eine <code>/var/lib/vdr/channels.conf</code> (diese Datei sollte dem Nutzer und der Gruppe <code>vdr</code> gehören).
</p>

<p>
Bevor man Änderungen an der Kanalliste vornimmt oder eine Kanalsuche mit einem Programm wie w_scan, t2scan usw. startet, muss der VDR gestoppt werden:
</p>
<pre class="example" id="org1b36855">
systemctl stop vdr
</pre>

<p>
Um an eine Kanalliste zu kommen, gibt es mehrere Möglichkeiten:
</p>
</div>
<ol class="org-ol">
<li><a id="channel-list-channelpedia"></a>Kanallisten aus der channelpedia<br />
<div class="outline-text-5" id="text-channel-list-channelpedia">
<p>
Die <a href="https://channelpedia.yavdr.com/gen/">Channelpedia</a> bietet eine Sammlung von Kanallisten für die gängigen Satellitenpositionen, Kabelnetze und den terrestrischen Empfang.
</p>
</div>
</li>
<li><a id="channel-search-w-scan"></a>Kanalsuche mit w_scan<br />
<div class="outline-text-5" id="text-channel-search-w-scan">
<p>
<a href="https://wiki.ubuntuusers.de/w_scan/">w_scan</a> erlaubt die Kanalsuche mit Tunern für DVB-S(2), DVB-C und DVB-T. Für DVB-T2 funktioniert das nachfolgend beschriebene t2scan besser.
</p>

<pre class="example" id="orgc70b23e">
$ sudo w_scan -c de -f c &gt; channels.conf
</pre>
</div>
</li>
<li><a id="channel-search-t2scan"></a>Kanalsuche mit t2scan<br />
<div class="outline-text-5" id="text-channel-search-t2scan">
<p>
<a href="https://github.com/mighty-p/t2scan">t2scan</a> ist speziell dafür ausgelegt nach DVB-T(2) Kanälen zu suchen.
</p>

<pre class="example" id="org256731c">
$ sudo t2scan &gt; channels.conf
</pre>
</div>
</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-system-basics" class="outline-2">
<h2 id="system-basics"><span class="section-number-2">2.</span> Grundlegendes zum System</h2>
<div class="outline-text-2" id="text-system-basics">
<p>
Dieser Abschnitt ist insbesondere für Leser gedacht, die noch nicht besonders viel Erfahrung damit haben ein Linux-System über eine Shell zu administrieren.
</p>
</div>
<div id="outline-container-ssh" class="outline-3">
<h3 id="ssh"><span class="section-number-3">2.1.</span> SSH</h3>
<div class="outline-text-3" id="text-ssh">
<p>
yavdr-ansible installiert einen SSH-Server, der es erlaubt sich von einem anderen Rechner aus auf dem System einzuloggen. Weiterführende Informationen gibt es im <a href="https://wiki.ubuntuusers.de/SSH/">Wiki-Artikel zu SSH</a>.
</p>
</div>
</div>

<div id="outline-container-root-permissions" class="outline-3">
<h3 id="root-permissions"><span class="section-number-3">2.2.</span> Mit erhöhten Rechten Arbeiten</h3>
<div class="outline-text-3" id="text-root-permissions">
<p>
Bei Ubuntu ist der Login für den Benutzer <code>root</code> standardmäßig deaktiviert (man kann das ändern, indem man für <code>root</code> ein Passwort vergibt, für den Zugriff über SSH als <code>root</code> muss außerdem die Konfiguration des SSH-Server angepasst werden). Man kann als Mitglied in der Gruppe <code>sudo</code> (der bei der Installation angelegte Nutzer ist standardmäßig Mitglied in dieser Gruppe) mit dem gleichnamigen Befehl erhöhte Rechte erlangen: <a href="https://wiki.ubuntuusers.de/sudo/">https://wiki.ubuntuusers.de/sudo/</a>
</p>
</div>
</div>
<div id="outline-container-editors" class="outline-3">
<h3 id="editors"><span class="section-number-3">2.3.</span> Editoren</h3>
<div class="outline-text-3" id="text-editors">
<p>
Um Dateien bearbeiten zu können, sollte man mit einem <a href="https://wiki.ubuntuusers.de/Editor/#Kommandozeile">Editor</a> umgehen können. Für Einsteiger bietet sich das vorinstallierte <a href="https://wiki.ubuntuusers.de/Nano/">nano</a> an. Das Programm <a href="https://wiki.ubuntuusers.de/mit_Root-Rechten_arbeiten/#sudoedit">sudoedit</a> kann genutzt werden, um Dateien mit root-Rechten zu bearbeiten.
</p>
</div>
</div>
<div id="outline-container-package-management" class="outline-3">
<h3 id="package-management"><span class="section-number-3">2.4.</span> Paketverwaltung</h3>
<div class="outline-text-3" id="text-package-management">
<p>
Ubuntu nutzt <code>apt</code> für die Paketverwaltung. Im Ubuntu Users Wiki findet sich alles wissenswerte <a href="https://wiki.ubuntuusers.de/Paketverwaltung/">zum Thema Paketverwaltung</a>.
</p>

<p>
Die am häufigsten genutzten Befehle sind:
</p>
<pre class="example" id="orge209884">
# Paketquellen neu einlesen
sudo apt update
# alle Pakete aktualisieren
sudo apt full-upgrade
# ein einzelnes Paket installieren
sudo apt install vdr-plugin-live
# mehrere Pakete installieren
sudo apt install vdr-plugin-epgsearch vdr-plugin-streamdev-server
# Pakete entfernen
sudo apt remove PAKETNAME [PAKETNAME_2 ..]
# PPA hinzufügen
sudo add-apt-repository ppa:seahawk1986-hotmail/vdr-2.4.0
</pre>
</div>
<div id="outline-container-apt-updates" class="outline-4">
<h4 id="apt-updates"><span class="section-number-4">2.4.1.</span> Updates Einspielen</h4>
<div class="outline-text-4" id="text-apt-updates">
<p>
Neben den Sicherheitsupdates, die für Ubuntu ausgeliefert werden (z.B. für Samba, Firefox, SSH usw.), versuchen wir yaVDR ständig zu verbessern und veröffentlichen daher häufiger Updates für VDR- und KODI-Pakete, Plugins, Addons, Skripte und Templates.
</p>

<p>
Gerade bevor man darüber nachdenkt eine Support-Anfrage im Forum (<a href="http://www.vdr-portal.de/">http://www.vdr-portal.de/</a>) zu stellen, sollte man überprüfen, ob der Fehler auch nach dem Einspielen der aktuellen Updates und einem anschließenden Neustart noch auftritt. Dieses Vorgehen reduziert auch den Support-Aufwand für das yaVDR-Team.
</p>

<p>
Man kann Updates entweder über Ansible anstoßen oder sie von Hand so einspielen:
</p>
<pre class="example" id="orgd93e3a3">
$ sudo apt update &amp;&amp; sudo apt full-upgrade
</pre>
<p>
Alternativ kann auch apt-get genutzt werden:
</p>
<pre class="example" id="org68d2634">
$ sudo apt-get update &amp;&amp; sudo apt-get dist-upgrade
</pre>

<p>
Wenn apt nachfragt, ob Konfigurationsdateien überschrieben werden sollen, empfiehlt es sich zunächst die Unterschiede anzeigen zu lassen und dann zu entscheiden, ob ein händisches Zusammenführen oder das Beibehalten der aktuellen Konfiguration (oder in seltenen Fällen die Übernahme der neuen Datei) sinnvoll ist.
</p>

<p>
Wenn die Updates über Ansible erfolgen, werden die Konfigurationsdateien automatisch auf den in den Ansible-Rollen vorgesehenen Stand gebracht.
</p>
</div>
</div>
<div id="outline-container-orgd25d991" class="outline-4">
<h4 id="orgd25d991"><span class="section-number-4">2.4.2.</span> Entfernen ungenutzter Pakete und alter Kernel</h4>
<div class="outline-text-4" id="text-2-4-2">
<p>
Um nicht mehr benötigte Pakete und Kernel-Versionen zu entfernen, kann dieser Befehl genutzt werden (Ubuntu behält dabei die drei aktuellsten Kernel-Pakete):
</p>
<pre class="example" id="org91242c7">
$ sudo apt autoremove --purge
</pre>
</div>
</div>
</div>
<div id="outline-container-systemd-services" class="outline-3">
<h3 id="systemd-services"><span class="section-number-3">2.5.</span> Dienste</h3>
<div class="outline-text-3" id="text-systemd-services">
<p>
Seit Ubuntu 16.04 setzt Ubuntu auf Systemd (<a href="https://www.freedesktop.org/wiki/Software/systemd/">https://www.freedesktop.org/wiki/Software/systemd/</a>) als Init-System, das bis Ubuntu 14.04 genutzte Upstart wurde entfernt und dafür geschriebene Units müssen portiert werden. Systemd bietet eine eingeschränkte Abwärtskompatibilität zu SysV-Init: <a href="https://www.freedesktop.org/wiki/Software/systemd/Incompatibilities/">https://www.freedesktop.org/wiki/Software/systemd/Incompatibilities/</a>
</p>
</div>
<div id="outline-container-systemctl" class="outline-4">
<h4 id="systemctl"><span class="section-number-4">2.5.1.</span> systemctl</h4>
<div class="outline-text-4" id="text-systemctl">
<p>
<a href="https://www.freedesktop.org/software/systemd/man/systemctl.html">systemctl</a> erlaubt es Systemd Units zu steuern. Die wichtigsten Befehle sind:
</p>

<pre class="example" id="orgb596fdf">
# Status einer Unit anzeigen
systemctl status vdr
# Unit starten
systemctl start vdr
# Unit neu starten
systemctl restart vdr
# Unit stoppen
systemctl stop vdr
# Unit deaktivieren (wird nicht mehr automatisch beim Booten gestartet)
systemctl disable vdr
# Unit aktivieren (wird gemäß ihres Install Abschitts automatisch beim Booten gestartet
systemctl enable vdr
# Unit maskieren (kann weder automatisch noch von Hand gestartet werden)
systemctl mask vdr
</pre>
</div>
</div>
</div>

<div id="outline-container-logfiles" class="outline-3">
<h3 id="logfiles"><span class="section-number-3">2.6.</span> Logdateien</h3>
<div class="outline-text-3" id="text-logfiles">
<p>
Bei Ubuntu 18.04 ist sowohl rsyslog als auch journald vorinstalliert. Die von rsyslog verwalteten Logdateien liegen wie gewohnt in <code>/var/log/</code>.
</p>

<p>
Zusätzlich kann man journalctl nutzen, um auf das von journald verwaltete Log zuzugreifen, z.B.:
</p>
<pre class="example">
# Logausgaben der Unit vdr.service beobachten
journalctl -u vdr -fl
# Logausgaben seit dem Booten anzeigen
journalctl -b
# Logausgaben der letzten 10 Minuten anzeigen
journalctl -l --since=-10m
</pre>

<p>
Journald legt in der Vorkonfiguration keine persistenten Logdateien an. Dieses Verhalten kann wie in <a href="https://wiki.ubuntuusers.de/systemd/journald/#Speichereinstellung-fuer-das-Journal-aendern">Speichereinstellungen für journald</a> beschrieben geändert werden.
</p>
</div>

<ol class="org-ol">
<li><a id="rsyslog-filtering"></a>Logeinträge filtern mit rsyslog<br />
<div class="outline-text-5" id="text-rsyslog-filtering">
<p>
rsyslog bietet die Möglichkeit Logeinträge nach Ursprung, Priorität oder Inhalt zu filtern.
</p>

<p>
Um z.B. alle Logmeldungen mit dem String <code>"dvb_frontend_get_frequency_limits"</code> zu verwerfen, könnte man eine <code>/etc/rsyslog.d/10-ignore.conf</code> mit dem folgenden Inhalt anlegen:
</p>
<div class="org-src-container">
<pre class="src src-conf">:msg,contains,<span class="org-string">"dvb_frontend_get_frequency_limits"</span> ~
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-audio-output" class="outline-3">
<h3 id="audio-output"><span class="section-number-3">2.7.</span> Audioausgabe</h3>
<div class="outline-text-3" id="text-audio-output">
<p>
Standardmäßig erfolgt die Audioausgabe über pulseaudio, um auch die Nutzung von Anwendungen zu ermöglichen, die keine Soundausgabe über Alsa beherrschen. Mit Ausnahmen einiger moderner Formate wie TrueHD or DTS-MA können Bitstream-Formate an den Receiver durchgereicht werden (&bdquo;Passthrough&ldquo;), so dass dieser die Dekodierung übernehmen kann.
</p>

<p>
In <a href="https://kodi.wiki/view/PulseAudio">https://kodi.wiki/view/PulseAudio</a> wird u.a. die Konfiguration von Pulseaudio bei Nutzung in Verbindung mit Mehrkanalreceivern beschrieben.
</p>

<p>
Bei Bedarf kann Pulseaudio vorübergehend oder komplett deaktiviert werden, um die Soundkarte für Programme freizugeben, die direkt mittels Alsa darauf zugreifen sollen.
</p>
</div>

<div id="outline-container-org415ea7f" class="outline-4">
<h4 id="org415ea7f"><span class="section-number-4">2.7.1.</span> Pulseaudio vorübergehend deaktivieren</h4>
<div class="outline-text-4" id="text-2-7-1">
<p>
Pulseaudio kann mit Hilfe von <code>pasuspender</code> vorübergehend deaktiviert werden, solange das Zielprogramm läuft - z.B. für KODI:
</p>
<pre class="example" id="org401426d">
pasuspender -- env AE_SINK=ALSA kodi
</pre>
<p>
Da sich der VDR mit softhddevice (oder einem der davon abgeleiteten Plugins, die keine eigenständigen Programme für die Ausgabe bereitstellen) nicht sinnvoll mit dem <code>pasuspender</code> wrappen lässt, wenn man zwischendurch Pulseaudio-Programme nutzen will, kann in diesem Fall auf <code>yavdr-pasuspend</code> zurückgegriffen werden:
</p>
<pre class="example" id="org9d5f0e7">
yavdr-pasuspend -s # pausiere Pulseaudio
yavdr-pasuspend -r # reaktiviere Pulseaudio
</pre>
<p>
Das yavdr-frontend ermöglicht es pulseaudio automatisch zu pausieren, wenn softhddevice (oder ein davon abgeleitetes Ausgabeplugin) aktiv ist - dazu muss in der <code>/etc/yavdr-frontend/config.yml</code> beim Eintrag für das jeweilige Frontend (vdr -&gt; frontends) die Option <code>use_pasuspend: true</code> gesetzt werden.
</p>

<p>
In dem Fall muss die Audiokonfiguration für das Ausgabeplugin für die gewünschten Alsa-Geräte angepasst werden.
</p>

<p>
Wichtig: Beim suspend von Pulseaudio frieren Pulseaudio-Clients mit aktiver Soundausgabe ein, bis der Suspend wieder aufgehoben wird.
</p>
</div>
</div>
<div id="outline-container-pulse-disable-permanently" class="outline-4">
<h4 id="pulse-disable-permanently"><span class="section-number-4">2.7.2.</span> Pulseaudio komplett deaktivieren</h4>
<div class="outline-text-4" id="text-pulse-disable-permanently">
<p>
Um Pulseaudio komplett zu deaktivieren, kann man in der <code>/var/lib/vdr/.config/pulse/daemon.conf</code> verhindern, dass der Dienst automatisch gestartet wird:
</p>
<div class="org-src-container">
<pre class="src src-conf"><span class="org-variable-name">autospawn</span> = no
</pre>
</div>

<p>
Nicht vergessen die Audiokonfiguration für das Ausgabeplugin auf die gewünschten Alsa-Geräte anzupassen!
</p>
</div>
</div>
<div id="outline-container-pulse-force-alsa" class="outline-4">
<h4 id="pulse-force-alsa"><span class="section-number-4">2.7.3.</span> Pulseaudio Nutzung von Alsa-Gerät erzwingen</h4>
<div class="outline-text-4" id="text-pulse-force-alsa">
<p>
Um die Nutzung von bestimmten Alsa-Geräten durch Pulseaudio zu erzwingen kann wie in <a href="https://wiki.archlinux.org/index.php/PulseAudio/Examples#Manually_configuring_PulseAudio_to_detect_the_Nvidia_HDMI">https://wiki.archlinux.org/index.php/PulseAudio/Examples#Manually_configuring_PulseAudio_to_detect_the_Nvidia_HDMI</a> beschrieben ein Pulseaudio-Sink mit einem Alsa-Gerät verknüpft werden:
</p>
<div class="org-src-container">
<pre class="src src-conf"><span class="org-variable-name">load-module module-alsa-sink device</span>=hw:1,7
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-remotes" class="outline-2">
<h2 id="remotes"><span class="section-number-2">3.</span> Fernbedienungen</h2>
<div class="outline-text-2" id="text-remotes">
<p>
yavdr-ansible nutzt <a href="https://github.com/OpenELEC/eventlircd">eventlircd</a>, um Signale von Fernbedienungsempfängern an den VDR, KODI, irexec und andere Lirc-Clients weiter zureichen.
</p>

<p>
<code>eventlircd</code> kann die Tastendrücke von Kernel Input Devices (wie sie für rc-core Geräte, HID-Geräte, virtuelle Eingabegeräte, die mittels uinput usw. angelegt werden) über udev-Regeln identifizieren und exklusiv öffnen. Tastatur-Tastendrücke werden auf einem lircd-kompatiblen Sockel (<code>/run/lirc/lircd</code>) ausgegeben, Maustastendrücke auf einem mittels uinput angelegten Virtuellen Kernel Input Device weitergereicht.
</p>

<p>
Da eventlircd keine Abhängigkeiten zu bereits initialisierter Hardware hat, kann der Dienst frühzeitig gestartet werden, ohne den Bootvorgang zu verzögern - die Empfänger werden dynamisch eingebunden, sobald sie verfügbar sind.
</p>

<p>
Alle Fernbedienungen sollten das vereinheitlichte Schema für Tastennamen nutzen, damit die von ihnen gesendeten Tastendrücke zur Vorkonfiguration der Fernbedienung für den VDR, KODI und andere Programme passen, wie in der Tabelle <a href="#org44f9603">&bdquo;Vereinheitlichtes Schema für Tastennamen&ldquo;</a> gezeigt.
</p>
</div>

<div id="outline-container-yavdr-namespace" class="outline-3">
<h3 id="yavdr-namespace"><span class="section-number-3">3.1.</span> Vereinheitlichtes Schema für Tastennamen</h3>
<div class="outline-text-3" id="text-yavdr-namespace">
<table id="org44f9603" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Tabelle 1</span> Vereinheitlichtes Schema für Tastennamen</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Tastenname Eventlircd</th>
<th scope="col" class="org-left">remote.conf</th>
<th scope="col" class="org-left">Beschreibung</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">KEY_UP</td>
<td class="org-left">LIRC.Up</td>
<td class="org-left">Nach oben</td>
</tr>

<tr>
<td class="org-left">KEY_DOWN</td>
<td class="org-left">LIRC.Down</td>
<td class="org-left">Nach unten</td>
</tr>

<tr>
<td class="org-left">KEY_MENU</td>
<td class="org-left">LIRC.Menu</td>
<td class="org-left">Menü</td>
</tr>

<tr>
<td class="org-left">KEY_OK</td>
<td class="org-left">LIRC.Ok</td>
<td class="org-left">OK/Eingabe</td>
</tr>

<tr>
<td class="org-left">KEY_ESC</td>
<td class="org-left">LIRC.Back</td>
<td class="org-left">Zurück</td>
</tr>

<tr>
<td class="org-left">KEY_LEFT</td>
<td class="org-left">LIRC.Left</td>
<td class="org-left">Nach links</td>
</tr>

<tr>
<td class="org-left">KEY_RIGHT</td>
<td class="org-left">LIRC.Right</td>
<td class="org-left">Nach rechts</td>
</tr>

<tr>
<td class="org-left">KEY_RED</td>
<td class="org-left">LIRC.Red</td>
<td class="org-left">Rot</td>
</tr>

<tr>
<td class="org-left">KEY_GREEN</td>
<td class="org-left">LIRC.Green</td>
<td class="org-left">Grün</td>
</tr>

<tr>
<td class="org-left">KEY_YELLOW</td>
<td class="org-left">LIRC.Yellow</td>
<td class="org-left">Gelb</td>
</tr>

<tr>
<td class="org-left">KEY_BLUE</td>
<td class="org-left">LIRC.Blue</td>
<td class="org-left">Blau</td>
</tr>

<tr>
<td class="org-left">KEY_0</td>
<td class="org-left">LIRC.0</td>
<td class="org-left">Ziffer 0</td>
</tr>

<tr>
<td class="org-left">KEY_1</td>
<td class="org-left">LIRC.1</td>
<td class="org-left">Ziffer 1</td>
</tr>

<tr>
<td class="org-left">KEY_2</td>
<td class="org-left">LIRC.2</td>
<td class="org-left">Ziffer 2</td>
</tr>

<tr>
<td class="org-left">KEY_3</td>
<td class="org-left">LIRC.3</td>
<td class="org-left">Ziffer 3</td>
</tr>

<tr>
<td class="org-left">KEY_4</td>
<td class="org-left">LIRC.4</td>
<td class="org-left">Ziffer 4</td>
</tr>

<tr>
<td class="org-left">KEY_5</td>
<td class="org-left">LIRC.5</td>
<td class="org-left">Ziffer 5</td>
</tr>

<tr>
<td class="org-left">KEY_6</td>
<td class="org-left">LIRC.6</td>
<td class="org-left">Ziffer 6</td>
</tr>

<tr>
<td class="org-left">KEY_7</td>
<td class="org-left">LIRC.7</td>
<td class="org-left">Ziffer 7</td>
</tr>

<tr>
<td class="org-left">KEY_8</td>
<td class="org-left">LIRC.8</td>
<td class="org-left">Ziffer 8</td>
</tr>

<tr>
<td class="org-left">KEY_9</td>
<td class="org-left">LIRC.9</td>
<td class="org-left">Ziffer 9</td>
</tr>

<tr>
<td class="org-left">KEY_INFO</td>
<td class="org-left">LIRC.Info</td>
<td class="org-left">Info zum aktuellen Objekt</td>
</tr>

<tr>
<td class="org-left">KEY_PLAY</td>
<td class="org-left">LIRC.Play</td>
<td class="org-left">Play</td>
</tr>

<tr>
<td class="org-left">KEY_PAUSE</td>
<td class="org-left">LIRC.Pause</td>
<td class="org-left">Pause</td>
</tr>

<tr>
<td class="org-left">KEY_PLAYPAUSE</td>
<td class="org-left">LIRC.Play/Pause</td>
<td class="org-left">Kombinierte Taste für Play und Pause</td>
</tr>

<tr>
<td class="org-left">KEY_STOP</td>
<td class="org-left">LIRC.Stop</td>
<td class="org-left">Stop</td>
</tr>

<tr>
<td class="org-left">KEY_RECORD</td>
<td class="org-left">LIRC.Record</td>
<td class="org-left">Aufnehmen</td>
</tr>

<tr>
<td class="org-left">KEY_FASTFORWARD</td>
<td class="org-left">LIRC.FastFwd</td>
<td class="org-left">Vorspulen</td>
</tr>

<tr>
<td class="org-left">KEY_REWIND</td>
<td class="org-left">LIRC.FastRew</td>
<td class="org-left">Zurückspulen</td>
</tr>

<tr>
<td class="org-left">KEY_NEXT</td>
<td class="org-left">LIRC.Next</td>
<td class="org-left">Vorwärts springen</td>
</tr>

<tr>
<td class="org-left">KEY_BACK</td>
<td class="org-left">LIRC.Prev</td>
<td class="org-left">Rückwärts springen</td>
</tr>

<tr>
<td class="org-left">KEY_POWER2</td>
<td class="org-left">LIRC.Power</td>
<td class="org-left">Ausschalten</td>
</tr>

<tr>
<td class="org-left">KEY_CHANNELUP</td>
<td class="org-left">LIRC.Channel+</td>
<td class="org-left">Kanal hoch</td>
</tr>

<tr>
<td class="org-left">KEY_CHANNELDOWN</td>
<td class="org-left">LIRC.Channel-</td>
<td class="org-left">Kanal runter</td>
</tr>

<tr>
<td class="org-left">KEY_PREVIOUS</td>
<td class="org-left">LIRC.PrevChannel</td>
<td class="org-left">zurück zum zuvor gewählten Kanal</td>
</tr>

<tr>
<td class="org-left">KEY_VOLUMEUP</td>
<td class="org-left">LIRC.Volume+</td>
<td class="org-left">Lautstärke erhöhen</td>
</tr>

<tr>
<td class="org-left">KEY_VOLUMEDOWN</td>
<td class="org-left">LIRC.Volume-</td>
<td class="org-left">Lautstärke verringern</td>
</tr>

<tr>
<td class="org-left">KEY_MUTE</td>
<td class="org-left">LIRC.Mute</td>
<td class="org-left">Stummschalten</td>
</tr>

<tr>
<td class="org-left">KEY_SUBTITLE</td>
<td class="org-left">LIRC.Subtitles</td>
<td class="org-left">Untertitel einblenden</td>
</tr>

<tr>
<td class="org-left">KEY_EPG</td>
<td class="org-left">LIRC.Schedule</td>
<td class="org-left">Programmführer</td>
</tr>

<tr>
<td class="org-left">KEY_CHANNEL</td>
<td class="org-left">LIRC.Channels</td>
<td class="org-left">Kanäle</td>
</tr>

<tr>
<td class="org-left">KEY_FAVORITES</td>
<td class="org-left">LIRC.Commands</td>
<td class="org-left">Befehlsauswahl</td>
</tr>

<tr>
<td class="org-left">KEY_MODE</td>
<td class="org-left">LIRC.Audio</td>
<td class="org-left">Tonspur wählen</td>
</tr>

<tr>
<td class="org-left">KEY_TIME</td>
<td class="org-left">LIRC.Timers</td>
<td class="org-left">gesetzte Timer</td>
</tr>

<tr>
<td class="org-left">KEY_PVR</td>
<td class="org-left">LIRC.Recordings</td>
<td class="org-left">Aufnahmen</td>
</tr>

<tr>
<td class="org-left">KEY_SETUP</td>
<td class="org-left">LIRC.Setup</td>
<td class="org-left">Setup-Menü</td>
</tr>

<tr>
<td class="org-left">KEY_TEXT</td>
<td class="org-left">LIRC.User0</td>
<td class="org-left">aktiviert Teletext bei installiertem teletext-plugin</td>
</tr>

<tr>
<td class="org-left">KEY_PROG1</td>
<td class="org-left">LIRC.User1</td>
<td class="org-left">User-Taste, z.B. für Keymakros</td>
</tr>

<tr>
<td class="org-left">KEY_PROG2</td>
<td class="org-left">LIRC.User2</td>
<td class="org-left">User-Taste, z.B. für Keymakros</td>
</tr>

<tr>
<td class="org-left">KEY_PROG3</td>
<td class="org-left">LIRC.User3</td>
<td class="org-left">User-Taste, z.B. für Keymakros</td>
</tr>

<tr>
<td class="org-left">KEY_PROG4</td>
<td class="org-left">LIRC.User4</td>
<td class="org-left">User-Taste, z.B. für Keymakros</td>
</tr>

<tr>
<td class="org-left">KEY_AUDIO</td>
<td class="org-left">LIRC.User5</td>
<td class="org-left">User-Taste, z.B. für Keymakros</td>
</tr>

<tr>
<td class="org-left">KEY_VIDEO</td>
<td class="org-left">LIRC.User6</td>
<td class="org-left">User-Taste, z.B. für Keymakros</td>
</tr>

<tr>
<td class="org-left">KEY_IMAGES</td>
<td class="org-left">LIRC.User7</td>
<td class="org-left">User-Taste, z.B. für Keymakros</td>
</tr>

<tr>
<td class="org-left">KEY_FN</td>
<td class="org-left">LIRC.User8</td>
<td class="org-left">User-Taste, z.B. für Keymakros</td>
</tr>

<tr>
<td class="org-left">KEY_SCREEN</td>
<td class="org-left">LIRC.User9</td>
<td class="org-left">User-Taste, z.B. für Keymakros</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-ir-keytable" class="outline-3">
<h3 id="ir-keytable"><span class="section-number-3">3.2.</span> ir-keytable</h3>
<div class="outline-text-3" id="text-ir-keytable">
<p>
Das Programm <code>ir-keytable</code> kann genutzt werden, um rc-core Geräte zu testen und zu konfigurieren. Damit <code>ir-keytable</code> Zugriff auf die Geräte hat, muss <a href="#eventlircd-specialities">eventlircd zuvor gestoppt werden</a>.
</p>

<pre class="example" id="org1cc4a59">
$ sudo ir-keytable
/sys/class/rc/rc0/ gefunden (/dev/input/event4) mit:
    Name: Nuvoton w836x7hg Infrared Remote Transceiver
    Treiber: nuvoton-cir, Tabelle: rc-rc6-mce
    Lirc Gerät: /dev/lirc0
    unterstützte Protokolle: lirc rc-5 rc-5-sz jvc sony nec sanyo mce_kbd rc-6 sharp xmp
    Aktivierte Protokolle: lirc rc-6
    bus: 25, Anbieter/Produkt: 1050:00b4, Version: 0x0073
    Wiederholungsverzögerung = 500 ms, Wiederholungsperiode = 125 ms
</pre>
</div>
<div id="outline-container-ir-keytable-customization" class="outline-4">
<h4 id="ir-keytable-customization"><span class="section-number-4">3.2.1.</span> Anpassen der Tastenbelegung für rc-core Empfänger</h4>
<div class="outline-text-4" id="text-ir-keytable-customization">
<p>
In der <code>/etc/rc_maps.cfg</code> können Regeln hinterlegt werden, für welche Kombination aus Treiber und Tabellen-Name welche Keytable geladen werden soll. Es zählt jeweils der erste Eintrag in der Datei für die angegebene Kombination.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Programmlisting 1 </span>Regel zum Laden der Keytable für den weiter oben gezeigten CIR-Empfänger</label><pre class="src src-config"># driver	  table				  file
nuvoton-cir rc-rc6-mce          /lib/udev/rc_keymaps/rc-rc6-mce
</pre>
</div>
</div>
<ol class="org-ol">
<li><a id="ir-keytable-create-keytables"></a>Eigene Keytables erzeugen<br />
<div class="outline-text-5" id="text-ir-keytable-create-keytables">
<p>
Möchte man eine Fernbedienung mit einem anderen IR-Protokoll bzw. abweichenden Tastencodes nutzen, kann eine eigene Keytable dafür geladen werden.
</p>

<p>
Damit uneingeschränkter Zugriff auf den Empfänger möglich ist, sollten die Systemd-Units <code>eventlircd.socket</code> und <code>eventlircd.service</code> gestoppt sein:
</p>
<div class="org-src-container">
<pre class="src src-shell">systemctl stop eventlircd.socket eventlircd.service
</pre>
</div>

<p>
Um die Keytable erzeugen zu können, benötigt man als erstes das Protokoll, das die Fernbedienung nutzt, um Tastendrücke zu senden. Wenn es nicht bekannt ist, kann man versuchen den Empfänger mit allen unterstützten Protokollen zu betreiben:
</p>
<div class="org-src-container">
<pre class="src src-shell">ir-keytable -c -p all -t
</pre>
</div>

<p>
Aus der Ausgabe 
</p>

<p>
Mit <code>ir-keytable -p $PROTOKOL</code> kann man das gewünschte Protokoll für den Empfänger setzen und danach mit mit <code>ir-keytable -c</code> die aktuell geladene Keytable löschen. Mit <code>sudo ir-keytable -t</code> kann man sich jetzt die Scancodes für gedrückte Tasten anzeigen lassen und diese in einer Keytable dem gewünschten Tastennamen zuordnen.
</p>
</div>



<ol class="org-ol">
<li><a id="ir-keytable-create-keytables-new-syntax"></a>Neue Syntax<br />
<div class="outline-text-6" id="text-ir-keytable-create-keytables-new-syntax">
<p>
ir-keytable hat ein neues Format für Keytables eingeführt - neben der alten Syntax wird jetzt auch das TOML-Format unterstützt - dabei werden wie in der Manpage beschrieben mindestens diese Abschnitte mit Feldern erwartet:
</p>
<div class="org-src-container">
<pre class="src src-toml">[[protcols]]
name = "rc-rc6-mce"  # yaVDR-Convention: Tabellen-Name laut rc-core, Name darf aber beliebig gewählt werden
protocol = "rc-6"  # Protokoll laut rc-core
[protocols.scancodes]
0xdeadbeef = "KEY_COFFEE"
</pre>
</div>
</div>
</li>

<li><a id="ir-keytable-create-keytables-old-syntax"></a>Alte Syntax<br />
<div class="outline-text-6" id="text-ir-keytable-create-keytables-old-syntax">
<p>
In der Ersten Zeile der Keytable sollte der vom Treiber vorgegebene Name der Keytable und das - oder falls gewünscht und vom Empfänger unterstützt die - gewünschten Protokolle angegeben werden und in den Folgenden Zeilen werden Scancode und Tastenname durch Whitespace getrennt angegeben - für den weiter oben genutzten CIR-Empfänger wäre das dann also z.B. für eine Fernbedienung mit <code>RC6</code> Protokoll:
</p>

<div class="org-src-container">
<pre class="src src-example"># table rc-rc6-mce, type: RC6
0xdeadbeef KEY_COFFEE
</pre>
</div>
</div>
</li>


<li><a id="lircd-to-rc-core"></a>Umstellung von lircd auf rc-core<br />
<div class="outline-text-6" id="text-lircd-to-rc-core">
<p>
Im Git-Repository der v4l-utils gibt es ein Skript, das dabei helfen kann eine bestehende lircd.conf in eine keymap (im TOML-Format) umzuwandeln: <a href="https://git.linuxtv.org/v4l-utils.git/tree/contrib/lircd2toml.py">https://git.linuxtv.org/v4l-utils.git/tree/contrib/lircd2toml.py</a>
</p>
</div>
</li>
<li><a id="rc-core-learn-keys"></a>Automatisiertes Anlernen von rc-core Empfängern<br />
<div class="outline-text-6" id="text-rc-core-learn-keys">
<p>
Um die Erstellung von Keytables zu vereinfachen, kann das folgende Python-Skript genutzt werden (benötigt das Paket <code>python3-evdev</code>) - die anzulernenden Tasten können in der Liste <code>BUTTONS</code> definiert werden:
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">import</span> functools
<span class="org-keyword">import</span> contextlib
<span class="org-keyword">import</span> signal
<span class="org-keyword">import</span> sys
<span class="org-keyword">import</span> time
<span class="org-keyword">from</span> argparse <span class="org-keyword">import</span> ArgumentParser
<span class="org-keyword">from</span> pathlib <span class="org-keyword">import</span> Path
<span class="org-keyword">from</span> evdev <span class="org-keyword">import</span> InputDevice, ecodes

<span class="org-variable-name">BUTTONS</span> = [
        <span class="org-string">"KEY_OK"</span>,
        <span class="org-string">"KEY_UP"</span>,
        <span class="org-string">"KEY_DOWN"</span>,
        <span class="org-string">"KEY_LEFT"</span>,
        <span class="org-string">"KEY_RIGHT"</span>,
        ]

<span class="org-variable-name">RC_SYS_DEVICES</span> = Path(<span class="org-string">'/sys/class/rc/'</span>)
<span class="org-variable-name">DEVPATH</span> = Path(<span class="org-string">'/dev'</span>)
<span class="org-variable-name">debug</span> = functools.partial(<span class="org-keyword">print</span>, <span class="org-builtin">file</span>=sys.stderr)


<span class="org-keyword">def</span> <span class="org-function-name">print_keymap</span>(keytable, protocol, keys):
    <span class="org-keyword">print</span>(<span class="org-string">"[[protocols]]"</span>)
    <span class="org-keyword">print</span>(f<span class="org-string">'name = "{keytable}"'</span>)
    <span class="org-keyword">print</span>(f<span class="org-string">'protocol = "{protocol}"'</span>)
    <span class="org-keyword">print</span>(<span class="org-string">'[protocols.scancodes]'</span>)
    <span class="org-keyword">for</span> keyname, scancode <span class="org-keyword">in</span> keys.items():
        <span class="org-keyword">print</span>(f<span class="org-string">'{scancode:#06x} = "{keyname}"'</span>)


<span class="org-keyword">def</span> <span class="org-function-name">read_from_device</span>(dev, keytable, protocol):
    <span class="org-keyword">def</span> <span class="org-function-name">btn_generator</span>():
        <span class="org-keyword">for</span> btn <span class="org-keyword">in</span> BUTTONS:
            <span class="org-keyword">yield</span> btn
        <span class="org-keyword">while</span> <span class="org-constant">True</span>:
            <span class="org-keyword">yield</span> <span class="org-constant">None</span>

    <span class="org-variable-name">btn_gen</span> = btn_generator()

    <span class="org-variable-name">keymap</span> = {}
    <span class="org-variable-name">last_scancode</span> = <span class="org-constant">None</span>
    <span class="org-variable-name">last_ts</span> = <span class="org-builtin">float</span>(<span class="org-string">'inf'</span>)

    <span class="org-variable-name">button</span> = <span class="org-builtin">next</span>(btn_gen)
    <span class="org-variable-name">first_btn</span> = button
    <span class="org-keyword">with</span> contextlib.closing(InputDevice(dev)) <span class="org-keyword">as</span> dev:
        debug(f<span class="org-string">"Please press a button for {button}"</span>)

        <span class="org-keyword">for</span> ev <span class="org-keyword">in</span> dev.read_loop():
            <span class="org-variable-name">advance_button</span> = <span class="org-constant">False</span>
            <span class="org-keyword">if</span> ev.<span class="org-builtin">type</span> == ecodes.EV_MSC:
                <span class="org-variable-name">ts</span> = ev.timestamp()
                <span class="org-keyword">if</span> (
                    ev.value == keymap.get(first_btn)
                    <span class="org-keyword">and</span> last_scancode == keymap.get(first_btn)
                    <span class="org-keyword">and</span> ts - last_ts &gt; .5
                ):

                    <span class="org-comment-delimiter"># </span><span class="org-comment">skip button because user pressed KEY_OK</span>
                    <span class="org-comment-delimiter"># </span><span class="org-comment">and it's not an unwanted repeat</span>
                    <span class="org-variable-name">advance_button</span> = <span class="org-constant">True</span>
                    debug(f<span class="org-string">"skipped learning button {button}"</span>)
                <span class="org-keyword">elif</span> last_scancode == ev.value:
                    <span class="org-comment-delimiter"># </span><span class="org-comment">repeated key</span>
                    <span class="org-keyword">pass</span>
                <span class="org-keyword">elif</span> ev.value != keymap.get(first_btn):
                    debug(f<span class="org-string">"Got scancode {ev.value:#06x} for {button}."</span>)
                    <span class="org-variable-name">advance_button</span> = <span class="org-constant">True</span>
                    <span class="org-variable-name">keymap</span>[button] = ev.value
                    <span class="org-variable-name">last_scancode</span> = ev.value

                <span class="org-variable-name">last_ts</span> = ts
                <span class="org-variable-name">last_scancode</span> = ev.value

            <span class="org-keyword">if</span> advance_button:
                <span class="org-variable-name">button</span> = <span class="org-builtin">next</span>(btn_gen)
                <span class="org-keyword">if</span> button:
                    debug(f<span class="org-string">"Please press a button for {button} (press KEY_OK to skip)"</span>)
                <span class="org-keyword">else</span>:
                    <span class="org-keyword">break</span>
        print_keymap(keytable, protocol, keymap)


<span class="org-keyword">def</span> <span class="org-function-name">list_devices</span>():
    <span class="org-variable-name">devices</span> = []
    <span class="org-keyword">for</span> rc_device <span class="org-keyword">in</span> RC_SYS_DEVICES.glob(<span class="org-string">'rc*'</span>):
        <span class="org-variable-name">device</span> = {}
        <span class="org-variable-name">device</span>[<span class="org-string">"path"</span>] = rc_device
        <span class="org-variable-name">device</span>[<span class="org-string">"sys"</span>] = rc_device.name

        <span class="org-keyword">with</span> <span class="org-builtin">open</span>(<span class="org-builtin">next</span>(rc_device.glob(<span class="org-string">'input*/event*/uevent'</span>))) <span class="org-keyword">as</span> f:
            <span class="org-comment-delimiter"># </span><span class="org-comment">read DEVNAME attribute (and others)</span>
            <span class="org-keyword">for</span> line <span class="org-keyword">in</span> f:
                <span class="org-variable-name">key</span>, <span class="org-variable-name">value</span> = line.rstrip().split(<span class="org-string">'='</span>)
                <span class="org-variable-name">device</span>[key] = value

        <span class="org-keyword">with</span> <span class="org-builtin">open</span>(rc_device.joinpath(<span class="org-string">'uevent'</span>)) <span class="org-keyword">as</span> f:
            <span class="org-keyword">for</span> line <span class="org-keyword">in</span> f:
                <span class="org-variable-name">key</span>, <span class="org-variable-name">value</span> = line.rstrip().split(<span class="org-string">'='</span>)
                <span class="org-variable-name">device</span>[key] = value

        <span class="org-keyword">with</span> <span class="org-builtin">open</span>(rc_device.joinpath(<span class="org-string">'protocols'</span>)) <span class="org-keyword">as</span> f:
            <span class="org-variable-name">protocols</span> = f.read().rstrip().split()
            <span class="org-variable-name">active_protocols</span> = [p[1:-1] <span class="org-keyword">for</span> p <span class="org-keyword">in</span> protocols <span class="org-keyword">if</span> (
                p.startswith(<span class="org-string">'['</span>) <span class="org-keyword">and</span> p != <span class="org-string">"[lirc]"</span>)]
            <span class="org-variable-name">inactive_protocols</span> = [p <span class="org-keyword">for</span> p <span class="org-keyword">in</span> protocols <span class="org-keyword">if</span> <span class="org-keyword">not</span> p.startswith(<span class="org-string">'['</span>)]
            <span class="org-variable-name">device</span>[<span class="org-string">"protocols"</span>] = protocols
            <span class="org-variable-name">device</span>[<span class="org-string">"inactive_protocols"</span>] = inactive_protocols
            <span class="org-variable-name">device</span>[<span class="org-string">"active_protocols"</span>] = active_protocols
            devices.append(device)
    <span class="org-keyword">return</span> devices


<span class="org-keyword">if</span> <span class="org-builtin">__name__</span> == <span class="org-string">'__main__'</span>:
    <span class="org-variable-name">parser</span> = ArgumentParser(description=<span class="org-string">"create keymaps for rc-core devices"</span>)
    parser.add_argument(<span class="org-string">'-p'</span>, <span class="org-string">'--protocol'</span>, metavar=<span class="org-string">'PROTOCOL'</span>,
                        <span class="org-builtin">help</span>=<span class="org-string">'set ir-protocol'</span>)
    parser.add_argument(<span class="org-string">'-d'</span>, <span class="org-string">'--device'</span>, metavar=<span class="org-string">'DEVICE'</span>, default=<span class="org-constant">None</span>,
                        <span class="org-builtin">help</span>=<span class="org-string">'ir device (e.g. rc0)'</span>)
    <span class="org-variable-name">args</span> = parser.parse_args()

    <span class="org-variable-name">devices</span> = list_devices()
    <span class="org-keyword">if</span> <span class="org-keyword">not</span> devices:
        sys.<span class="org-constant">exit</span>(<span class="org-string">"No rc-core devices found. Exiting."</span>)
    <span class="org-keyword">elif</span> <span class="org-builtin">len</span>(devices) == 1:
        <span class="org-keyword">print</span>(f<span class="org-string">"Using device {devices[0]['NAME']}"</span>, <span class="org-builtin">file</span>=sys.stderr)
        <span class="org-variable-name">dev</span> = devices[0][<span class="org-string">'path'</span>]
        <span class="org-variable-name">input_dev</span> = devices[0][<span class="org-string">'DEVNAME'</span>]
        <span class="org-variable-name">keytable</span> = devices[0][<span class="org-string">'NAME'</span>]
        <span class="org-variable-name">protocol</span> = <span class="org-string">","</span>.join(devices[0][<span class="org-string">'active_protocols'</span>])
    <span class="org-keyword">else</span>:
        <span class="org-keyword">if</span> args.device:
            <span class="org-keyword">for</span> d <span class="org-keyword">in</span> devices:
                <span class="org-keyword">if</span> (d[<span class="org-string">'sys'</span>] == args.device
                        <span class="org-keyword">or</span> d[<span class="org-string">'path'</span>] == RC_SYS_DEVICES.joinpath(args.device)):
                    <span class="org-variable-name">dev</span> = RC_SYS_DEVICES.joinpath(args.device)
                    <span class="org-variable-name">input_dev</span> = d[<span class="org-string">'DEVNAME'</span>]
                    <span class="org-variable-name">keytable</span> = d[<span class="org-string">'NAME'</span>]
                    <span class="org-variable-name">protocol</span> = <span class="org-string">","</span>.join(d[<span class="org-string">'active_protocols'</span>])
        <span class="org-keyword">else</span>:
            <span class="org-keyword">for</span> i, d <span class="org-keyword">in</span> <span class="org-builtin">enumerate</span>(devices, start=1):
                <span class="org-keyword">if</span> <span class="org-keyword">not</span> args.protocol:
                    <span class="org-keyword">print</span>(f<span class="org-string">"{i}) {d['DEV_NAME']} ({','.join(d.get('active_protocols'))})"</span>)
                <span class="org-keyword">else</span>:
                    <span class="org-keyword">print</span>(f<span class="org-string">"{i}) {d['DEV_NAME']}"</span>)
            <span class="org-keyword">try</span>:
                <span class="org-variable-name">dev_num</span> = <span class="org-builtin">int</span>(<span class="org-builtin">input</span>(<span class="org-string">"\tUse device numer: "</span>))
                <span class="org-keyword">if</span> dev_num &lt; 0 <span class="org-keyword">or</span> dev_num &gt; <span class="org-builtin">len</span>(devices):
                    <span class="org-keyword">raise</span> <span class="org-type">ValueError</span>
                <span class="org-variable-name">d</span> = devices[dev_num - 1]
            <span class="org-keyword">except</span> (<span class="org-type">ValueError</span>, <span class="org-type">IndexError</span>):
                sys.<span class="org-constant">exit</span>(<span class="org-string">"invalid device number"</span>)
            <span class="org-variable-name">input_dev</span> = d[<span class="org-string">'DEVNAME'</span>]
            <span class="org-variable-name">keytable</span> = d[<span class="org-string">'NAME'</span>]
            <span class="org-variable-name">protocol</span> = <span class="org-string">","</span>.join(d[<span class="org-string">'active_protocols'</span>])
            <span class="org-variable-name">dev</span> = d[<span class="org-string">'path'</span>]

    <span class="org-comment-delimiter"># </span><span class="org-comment">set ir-protocol(s)</span>
    <span class="org-keyword">if</span> args.protocol:
        <span class="org-keyword">try</span>:
            <span class="org-keyword">with</span> <span class="org-builtin">open</span>(dev.joinpath(<span class="org-string">'protocols'</span>), <span class="org-string">'w'</span>) <span class="org-keyword">as</span> f:
                f.write(args.protocol)
        <span class="org-keyword">except</span> <span class="org-type">PermissionError</span> <span class="org-keyword">as</span> e:
            sys.<span class="org-constant">exit</span>(f<span class="org-string">"Error: insifficient permissions to change protocol - are you root?"</span>)
        <span class="org-keyword">except</span> <span class="org-type">IOError</span> <span class="org-keyword">as</span> e:
            sys.<span class="org-constant">exit</span>(f<span class="org-string">"Error: could not set protocol(s) to {args.protocol}: {e}"</span>)
        <span class="org-variable-name">protocol</span> = args.protocol

    <span class="org-variable-name">input_dev</span> = DEVPATH.joinpath(input_dev)
    debug(<span class="org-string">"using device: "</span>, input_dev)

    <span class="org-keyword">def</span> <span class="org-function-name">signal_handler</span>(signum, frame):
        sys.<span class="org-constant">exit</span>()

    <span class="org-keyword">for</span> signame <span class="org-keyword">in</span> {<span class="org-string">'SIGINT'</span>, <span class="org-string">'SIGTERM'</span>}:
        signal.signal(
            <span class="org-builtin">getattr</span>(signal, signame),
            signal_handler)
    <span class="org-keyword">try</span>:
        read_from_device(input_dev, keytable, protocol)
    <span class="org-keyword">except</span> <span class="org-type">PermissionError</span> <span class="org-keyword">as</span> e:
        sys.<span class="org-constant">exit</span>(f<span class="org-string">"Error: can't open {input_dev} - are you root?"</span>)
</pre>
</div>
</div>
</li>
</ol>
</li>
</ol>
</div>
</div>
<div id="outline-container-lircd2uinput" class="outline-3">
<h3 id="lircd2uinput"><span class="section-number-3">3.3.</span> lircd2uinput</h3>
<div class="outline-text-3" id="text-lircd2uinput">
<p>
lircd2uinput kann von einem oder mehreren lircd-kompatiblen Sockeln lesen und diese Tastendrücke über ein virtuelles Eingabegerät mit Hilfe von uinput ausgeben.
</p>

<p>
Alle Programme, die einen lircd-kompatiblen Sockel bereitstellen (z.B. lircd, ir-server, irmplircd usw.), können über <code>lircd2uinput</code> an <code>eventlircd</code> angebunden werden. Mit dem Programm <code>lircd2uinput-add "$SOCKET"</code> kann man lircd2uinput anweisen einen Sockel auszulesen und mit <code>lircd2uinput-remove "$SOCKET"</code> wieder damit aufzuhören. Die vom Ansible Playbook installierten Dienste werden automatisch passend konfiguriert.
</p>
</div>
</div>
<div id="outline-container-eventlircd" class="outline-3">
<h3 id="eventlircd"><span class="section-number-3">3.4.</span> eventlircd</h3>
<div class="outline-text-3" id="text-eventlircd">
<p>
Eventlircd liest Tastendrücke von allen Kernel Input Devices, die das Udev-Attribut <code>ENV{eventlircd_enable}="true"</code> tragen. Optional kann über das Attribut <code>ENV{eventlircd_evmap}="evmap.evmap"</code> eine im Ordner <code>/etc/eventlircd.d/</code> hinterlegte evmap genutzt werden, die dazu dient Tastendrücke bzw. Tastenkombinationen auf den in der Tabelle <a href="#org44f9603">&bdquo;Vereinheitlichtes Schema für Tastennamen&ldquo;</a> beschriebenen Namespace umzuformen. evmaps sollten genutzt werden, wenn die Anpassung der Tastennamen nicht früher wie z.B. durch Keymap für rc-core Empfänger, lircd oder andere Wege erfolgen kann.
</p>
</div>

<div id="outline-container-eventlircd-specialities" class="outline-4">
<h4 id="eventlircd-specialities"><span class="section-number-4">3.4.1.</span> Besonderheiten für eventlircd</h4>
<div class="outline-text-4" id="text-eventlircd-specialities">
<p>
Dienste mit Socket-Activation wie eventlircd erfordern eine besondere Behandlung, wenn man sie stoppen möchte - da die <code>eventlircd.socket</code> die <code>eventlircd.service</code> beim Zugriff auf den Sockel-Pfad <code>/run/lirc/lircd</code> startet, müssen beide maskiert und gestoppt werden, wenn man z.B. mit <code>evtest</code> oder <code>ir-keytable</code> auf die von eventlircd exklusiv geöffneten Kernel Input Devices zugreifen möchte:
</p>
<pre class="example" id="org273e359">
systemctl stop eventlircd.{service,socket}
</pre>
<p>
Um eventlircd wieder zu aktivieren:
</p>
<pre class="example" id="orgc611dba">
systemctl start eventlircd.{service,socket}
</pre>
</div>
</div>
</div>
<div id="outline-container-lircd" class="outline-3">
<h3 id="lircd"><span class="section-number-3">3.5.</span> lircd</h3>
<div class="outline-text-3" id="text-lircd">
<p>
Die meisten ehemals nur in Verbindung mit lirc nutzbaren Treiber wurden bereits auf rc-core portiert, <code>lircd</code> ist daher nur noch für ein paar Geräte nötig. Dazu gehören die beiden vom Playbook automatisch eingerichteten IR-Empfänger Atric IrWakeupUSB und die YaUsbIR-Empfänger. Wenn ein solcher Empfänger während der Installation angeschlossen war, muss nur noch eine passende lircd.conf angelernt bzw. eine bereits vorhandene Datei nach <code>/etc/lirc/lircd.conf.d/</code> kopiert werden.
</p>
</div>
</div>
<div id="outline-container-debug-remote" class="outline-3">
<h3 id="debug-remote"><span class="section-number-3">3.6.</span> Tools zum Debuggen von Tastendrücken</h3>
<div class="outline-text-3" id="text-debug-remote">
</div>
<div id="outline-container-evtest" class="outline-4">
<h4 id="evtest"><span class="section-number-4">3.6.1.</span> evtest</h4>
<div class="outline-text-4" id="text-evtest">
<p>
<code>evtest</code> kann die Rohdaten für Tastendrücke von Kernel Input Devices lesen. Ruft man es ohne einen Pfad für ein solches Gerät auf, kann man interaktiv ein Gerät aus einer Liste wählen. Wichtig ist eventlircd vorher zu stoppen ( vgl. <a href="#eventlircd-specialities">Besonderheiten für eventlircd</a>), damit Tastendrücke von Geräten ausgelesen werden können, die der Dienst exklusiv geöffnet hat.
</p>
</div>
</div>
<div id="outline-container-ir-keytable-test" class="outline-4">
<h4 id="ir-keytable-test"><span class="section-number-4">3.6.2.</span> ir-keytable</h4>
<div class="outline-text-4" id="text-ir-keytable-test">
<p>
Bei rc-core Geräten kann <code>ir-keytable</code> genutzt werden, um mittels <code>sudo ir-keytable -t</code> ankommende Tastendrücke auszulesen.
Damit <code>ir-keytable</code> Zugriff auf die Geräte hat, muss <a href="#eventlircd-specialities">eventlircd zuvor gestoppt werden</a>.
</p>
</div>
</div>
<div id="outline-container-irw" class="outline-4">
<h4 id="irw"><span class="section-number-4">3.6.3.</span> irw</h4>
<div class="outline-text-4" id="text-irw">
<p>
<code>irw</code> kann von allen lirc-kompatiblen Sockeln lesen, wird es ohne Argumente aufgerufen, liest es von <code>/run/lirc/lircd</code>, was in der Vorkonfiguration der Sockel von eventlircd ist.
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-network-services" class="outline-2">
<h2 id="network-services"><span class="section-number-2">4.</span> Netzwerkdienste</h2>
<div class="outline-text-2" id="text-network-services">
</div>
<div id="outline-container-network-shares" class="outline-3">
<h3 id="network-shares"><span class="section-number-3">4.1.</span> Netzwerkfreigaben</h3>
<div class="outline-text-3" id="text-network-shares">
<p>
In der Vorkonfiguration exportiert yavdr-ansible folgende Verzeichnisfreigaben über NFS und Samba:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Name</th>
<th scope="col" class="org-left">Verzeichnis</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">audio</td>
<td class="org-left"><code>/srv/audio</code></td>
</tr>

<tr>
<td class="org-left">video</td>
<td class="org-left"><code>/srv/video</code></td>
</tr>

<tr>
<td class="org-left">pictures</td>
<td class="org-left"><code>/srv/picture</code></td>
</tr>

<tr>
<td class="org-left">files</td>
<td class="org-left"><code>/srv/files</code></td>
</tr>

<tr>
<td class="org-left">backups</td>
<td class="org-left"><code>/srv/backups</code></td>
</tr>

<tr>
<td class="org-left">recordings</td>
<td class="org-left"><code>/srv/vdr/video</code></td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-avahi-linker" class="outline-4">
<h4 id="avahi-linker"><span class="section-number-4">4.1.1.</span> avahi-linker</h4>
<div class="outline-text-4" id="text-avahi-linker">
<p>
Der <code>avahi-linker</code> sucht nach Ankündigungen von NFS-Freigaben mit dem Subtyp <code>_nfs._tcp</code> und bindet diese automatisch ein. So können sich Rechner im Netzwerk gegenseitig Dateifreigaben zur Verfügung stellen.
</p>
</div>

<ol class="org-ol">
<li><a id="avahi-service-syntax"></a>Freigaben ankündigen<br />
<div class="outline-text-5" id="text-avahi-service-syntax">
<p>
Der <code>avahi-daemon</code> liest die Dateien in <code>/etc/avahi/services/</code> ein und kündigt diese im Netzwerk an. Der Wert für <code>subtype</code> beeinflusst an welcher Stelle eine Freigabe von avahi-linker eingebunden wird. <code>subtype=vdr</code> ist für Freigaben vorgesehen, die VDR-Aufzeichnungen enthalten.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Programmlisting 2 </span>Beispiel für die Ankünfigung des VDR-Aufnahmeverzeichnis über Avahi</label><pre class="src src-xml"><span class="org-nxml-processing-instruction-delimiter">&lt;?</span><span class="org-nxml-processing-instruction-target">xml</span> <span class="org-nxml-processing-instruction-content">version="1.0" standalone='no'</span><span class="org-nxml-processing-instruction-delimiter">?&gt;</span>
&lt;!<span class="org-nxml-text">DOCTYPE service-group SYSTEM "avahi-service.dtd"&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">service-group</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">name</span> <span class="org-nxml-attribute-local-name">replace-wildcards</span>=<span class="org-string">"yes"</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">Recordings on %h</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">name</span><span class="org-nxml-tag-delimiter">&gt;</span> <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">Name der Freigabe, %h entspricht dem Hostname </span><span class="org-comment-delimiter">--&gt;</span>
    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">service</span><span class="org-nxml-tag-delimiter">&gt;</span>
      <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">type</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">_nfs._tcp</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">type</span><span class="org-nxml-tag-delimiter">&gt;</span>
      <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">port</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">2049</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">port</span><span class="org-nxml-tag-delimiter">&gt;</span>
      <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">txt-record</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">path=/srv/vdr/video</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">txt-record</span><span class="org-nxml-tag-delimiter">&gt;</span>   <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">Pfad der NFS-Freigabe </span><span class="org-comment-delimiter">--&gt;</span>
      <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">txt-record</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">subtype=vdr</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">txt-record</span><span class="org-nxml-tag-delimiter">&gt;</span>           <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">Subtyp </span><span class="org-comment-delimiter">--&gt;</span>
    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">service</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">service-group</span><span class="org-nxml-tag-delimiter">&gt;</span>
</pre>
</div>

<p>
Über einen <code>&lt;txt-record&gt;</code> für <code>category</code> können Unterverzeichnisse abgebildet werden:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Programmlisting 3 </span>Beispiel für eine Freigabe mit Filmen für das Videoverzeichnis</label><pre class="src src-xml"><span class="org-nxml-processing-instruction-delimiter">&lt;?</span><span class="org-nxml-processing-instruction-target">xml</span> <span class="org-nxml-processing-instruction-content">version="1.0" standalone='no'</span><span class="org-nxml-processing-instruction-delimiter">?&gt;</span>
&lt;!<span class="org-nxml-text">DOCTYPE service-group SYSTEM "avahi-service.dtd"&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">service-group</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">name</span> <span class="org-nxml-attribute-local-name">replace-wildcards</span>=<span class="org-string">"yes"</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">Movies on %h</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">name</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text"> ## Name</span>
<span class="org-nxml-text">  </span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">service</span><span class="org-nxml-tag-delimiter">&gt;</span>
    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">type</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">_nfs._tcp</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">type</span><span class="org-nxml-tag-delimiter">&gt;</span>
    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">port</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">2049</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">port</span><span class="org-nxml-tag-delimiter">&gt;</span>
    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">txt-record</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">path=/srv/video/movies</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">txt-record</span><span class="org-nxml-tag-delimiter">&gt;</span> <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">Pfad der NFS-Freigabe </span><span class="org-comment-delimiter">--&gt;</span>
    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">txt-record</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">subtype=video</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">txt-record</span><span class="org-nxml-tag-delimiter">&gt;</span> <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">Subtyp </span><span class="org-comment-delimiter">--&gt;</span>
    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">txt-record</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">category=movies</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">txt-record</span><span class="org-nxml-tag-delimiter">&gt;</span> <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">Kategorie </span><span class="org-comment-delimiter">--&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">service</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">service-group</span><span class="org-nxml-tag-delimiter">&gt;</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Programmlisting 4 </span>Beispiel für eine Freigabe mit Serien für das Videoverzeichnis</label><pre class="src src-xml"><span class="org-nxml-processing-instruction-delimiter">&lt;?</span><span class="org-nxml-processing-instruction-target">xml</span> <span class="org-nxml-processing-instruction-content">version="1.0" standalone='no'</span><span class="org-nxml-processing-instruction-delimiter">?&gt;</span>
&lt;!<span class="org-nxml-text">DOCTYPE service-group SYSTEM "avahi-service.dtd"&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">service-group</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">name</span> <span class="org-nxml-attribute-local-name">replace-wildcards</span>=<span class="org-string">"yes"</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">Movies on %h</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">name</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text"> ## Name</span>
<span class="org-nxml-text">  </span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">service</span><span class="org-nxml-tag-delimiter">&gt;</span>
    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">type</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">_nfs._tcp</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">type</span><span class="org-nxml-tag-delimiter">&gt;</span>
    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">port</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">2049</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">port</span><span class="org-nxml-tag-delimiter">&gt;</span>
    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">txt-record</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">path=/srv/video/tv-series</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">txt-record</span><span class="org-nxml-tag-delimiter">&gt;</span> <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">Pfad der NFS-Freigabe </span><span class="org-comment-delimiter">--&gt;</span>
    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">txt-record</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">subtype=video</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">txt-record</span><span class="org-nxml-tag-delimiter">&gt;</span> <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">Subtyp </span><span class="org-comment-delimiter">--&gt;</span>
    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">txt-record</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">category=series</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">txt-record</span><span class="org-nxml-tag-delimiter">&gt;</span> <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">Kategorie </span><span class="org-comment-delimiter">--&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">service</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">service-group</span><span class="org-nxml-tag-delimiter">&gt;</span>
</pre>
</div>
<p>
Alle anderen Freigaben werden unter den Namen des Subtyps und falls Vorhanden der Kategorie (die übersetzt werden, falls sie in den Übersetzungsdateien aus dem Paket <code>yavdr-i18n</code> enthalten sind) unterhalb von <code>/media/</code> eingebunden.
</p>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-nfs-server" class="outline-3">
<h3 id="nfs-server"><span class="section-number-3">4.2.</span> NFS</h3>
<div class="outline-text-3" id="text-nfs-server">
<p>
Zusätzliche NFS-Freigaben können in der <code>/etc/exports</code> bzw. in dem Template für die Datei definiert werden.
</p>
</div>
</div>
<div id="outline-container-samba-server" class="outline-3">
<h3 id="samba-server"><span class="section-number-3">4.3.</span> Samba</h3>
<div class="outline-text-3" id="text-samba-server">
<p>
Zusätzliche Samba-Freigaben können in der Datei <code>/etc/samba/smb.conf.custom</code> eingetragen werden.
</p>
</div>
</div>
</div>
<div id="outline-container-xorg-output" class="outline-2">
<h2 id="xorg-output"><span class="section-number-2">5.</span> Ausgabe mit Xorg</h2>
<div class="outline-text-2" id="text-xorg-output">
<p>
Während der VDR als System Dienst läuft, werden die vom Nutzer benötigten Dienste und Programme im Rahmen einer Systemd User Session gestartet.
</p>

<p>
Der Start der Benutzersitzung für den User vdr ist folgendermaßen umgesetzt:
</p>
<ul class="org-ul">
<li>Der Systemdienst <code>yavdr-xorg.service</code> startet die beiden abhängigen Dienste <code>x@vt7.service</code> und <code>xlogin@vdr.service</code></li>
<li><code>xlogin@vdr.service</code> startet über die <code>/var/lib/vdr/.xinitrc</code> eine <code>openbox-session</code></li>
<li>Openbox ruft das Skript <code>/var/lib/vdr/.config/openbox/autostart</code> auf</li>
<li>Das Autostart Skript bereitet die Sitzung vor und ruft das Systemd-Target <code>yavdr-desktop.target</code> für die Systemd User Session auf, so dass alle davon abhängigen Dienste gestartet werden</li>
</ul>
</div>

<div id="outline-container-org436730f" class="outline-3">
<h3 id="org436730f"><span class="section-number-3">5.1.</span> Zugriff auf die Systemd User Session</h3>
<div class="outline-text-3" id="text-5-1">
<p>
Um Dienste in der Systemd-User Session zu steuern gibt es zwei Möglichkeiten:
</p>
</div>
<div id="outline-container-systemctl-user-session" class="outline-4">
<h4 id="systemctl-user-session"><span class="section-number-4">5.1.1.</span> Einzelne Befehl mit passenden Rechten und Umgebungsvariablen absetzen:</h4>
<div class="outline-text-4" id="text-systemctl-user-session">
<p>
Man kann sich die nötigen Rechte verschaffen, um Dienste in der User Session mit <code>systemctl</code> zu steuern: - so wird z.B. der Dienst <code>osd2web.service</code> neu gestartet:
</p>
<div class="org-src-container">
<pre class="src src-example">sudo -u vdr DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/666/bus systemctl --user restart osd2web.service
</pre>
</div>

<p>
Für die häufigere Nutzung kann es hilfreich sein, sich einen <a href="https://wiki.ubuntuusers.de/alias/">alias</a> in der <code>~/.bashrc</code> zu definieren:
</p>
<div class="org-src-container">
<pre class="src src-shell"><span class="org-builtin">alias</span> <span class="org-variable-name">sctlu</span>=<span class="org-string">"sudo -u vdr DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/666/bus systemctl --user "</span>
</pre>
</div>
<p>
Damit reduziert sich der oben gezeigte Befehl auf:
</p>
<div class="org-src-container">
<pre class="src src-example">sctlu restart osd2web
</pre>
</div>
</div>
</div>
<div id="outline-container-tmux-user-session" class="outline-4">
<h4 id="tmux-user-session"><span class="section-number-4">5.1.2.</span> Zugriff mit tmux</h4>
<div class="outline-text-4" id="text-tmux-user-session">
<p>
Möchte man umfangreichere Anpassungen vornehmen, kann es sich lohnen eine Shell zu öffnen, die Zugriff auf die Systemd User Session des Benutzers <code>vdr</code> hat - mit Hilfe von <a href="https://wiki.ubuntuusers.de/tmux">tmux</a> kann man sich mit dem von der <code>tmux.service</code> in der User Session gestarteten Dienst verbinden:
</p>
<div class="org-src-container">
<pre class="src src-example">sudo tmux -S /tmp/tmux-666/default
</pre>
</div>
<p>
Möchte man automatisch die Umgebungsvariablen der Systemd User Session laden, kann man in der <code>/var/lib/vdr/.bashrc</code> einen der folgenden Einträge nutzen:
</p>
<div class="org-src-container">
<pre class="src src-shell"><span class="org-builtin">source</span> &lt;(systemctl --user show-environment)
<span class="org-comment-delimiter"># </span><span class="org-comment">bzw.</span>
<span class="org-builtin">export</span> $(<span class="org-sh-quoted-exec">systemctl</span> --user show-environment)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-yavdr-frontend" class="outline-3">
<h3 id="yavdr-frontend"><span class="section-number-3">5.2.</span> yavdr-frontend</h3>
<div class="outline-text-3" id="text-yavdr-frontend">
<p>
<code>yavdr-frontend</code> ist ein in Python3 geschriebenes Programm, das das VDR-Frontend und andere Programme steuert.
</p>
</div>

<div id="outline-container-org784507a" class="outline-4">
<h4 id="org784507a"><span class="section-number-4">5.2.1.</span> Verhalten beim Start</h4>
<div class="outline-text-4" id="text-5-2-1">
<p>
<code>yavdr-frontend</code> kennt ein primäres und ein sekundäres Frontend, in der Voreinstellungen sind diese mit der VDR Ausgabe und KODI vorbelegt.
</p>

<p>
Beim Starten prüft <code>yavdr-frontend</code>, ob es Hinweise dafür gibt, dass der VDR für einen Timer, Plugin oder einen vom vdr-addon-acpiwakup gesetzten Aufweckzeitpunkt gestartet wurde. Wenn das nicht der Fall ist, wird das VDR-Frontend gestartet, ansonsten bleibt es inaktiv, bis der Nutzer eine Taste auf der Fernbedienung bzw. <code>SUPER + A</code> auf der Tastatur drückt oder auf einem anderen Weg den Befehl <code>frontend-dbus-send start</code> absetzt.
</p>

<p>
Das Startverhalten lässt sich in der <code>/etc/yavdr-frontend/config.yml</code> anpassen. Dazu kann im Abschnitt <code>vdr</code> der Wert für <code>attach_on_startup</code> angepasst werden. Die möglichen Werte sind:
</p>
<dl class="org-dl">
<dt><code>auto</code></dt><dd>VDR-Frontend wird nur attached, wenn der VDR nicht für einen Timer, ein Plugin bzw. acpiwakeup gestartet wurde</dd>
<dt><code>always</code></dt><dd>VDR-Frontend wird immer attached</dd>
<dt><code>never</code></dt><dd>VDR-Frontend bleibt beim Start detached und kann durch Benutzeraktivität attached werden</dd>
</dl>
</div>
</div>
</div>

<div id="outline-container-start-programs" class="outline-3">
<h3 id="start-programs"><span class="section-number-3">5.3.</span> Programme starten</h3>
<div class="outline-text-3" id="text-start-programs">
</div>
<div id="outline-container-orgfb5fd36" class="outline-4">
<h4 id="orgfb5fd36"><span class="section-number-4">5.3.1.</span> desktop-Plugin</h4>
<div class="outline-text-4" id="text-5-3-1">
<p>
Das desktop-Plugin (Menüpunkt &bdquo;Applikationen&ldquo; bei Nutzung von menuorg) bildet die GNOME-Menüstruktur ab - wenn eine Anwendung eine <a href="https://wiki.ubuntuusers.de/.desktop-Dateien/">.desktop</a> Datei mitbringt (oder man eine <code>.desktop</code> Datei für eine Anwendung hinterlegst), kann man sie darüber &bdquo;standalone&ldquo; starten (unter der Voraussetzung, dass der Prozess nicht forkt oder sich sonst der Kontrolle durch die generische Systemd-Unit entzieht). Im Hintergrund wird dann über <code>/var/lib/vdr/plugins/desktop/starter</code> (was ein symbolischer Link auf <code>/usr/bin/start-desktop</code> ist) mit dem Pfad der <code>.desktop</code> Datei aufgerufen. Das yavdr-frontend sieht dann nach, ob es eine Systemd-Unit mit dem Namen gibt (abzüglich einer eventuell vorhandenen <code>.desktop</code> Endung - das kann man z.B. nutzen, wenn Programme mit speziellen Argumenten gestartet werden müssen oder zum Beenden besondere Befehle nötig sind - vgl. z.B. <code>/var/lib/vdr/.config/systemd/user/kodi.service</code>) , ansonsten fällt es auf <code>/usr/lib/systemd/user/app@.service</code> zurück und startet eine Instanz mit dem Namen der Anwendung.
</p>

<p>
Wenn eine <code>.desktop</code> Datei (keine Systemd-Unit!) parallel zum VDR-Frontend über menuorg gestartet werden soll, kann man das mit dem Programm <code>/usr/bin/run-desktop-file</code> machen, da für den VDR passende Umgebungsvariablen gesetzt sind, um auf die Session zugreifen zu können.
</p>
</div>
</div>
<div id="outline-container-frontend-dbus-send" class="outline-4">
<h4 id="frontend-dbus-send"><span class="section-number-4">5.3.2.</span> frontend-dbus-send</h4>
<div class="outline-text-4" id="text-frontend-dbus-send">
<p>
yavdr-frontend bietet außerdem eine DBus-API an, über die man den Wechsel je nach Anwendungszweck schöner steuern kann - für menuorg-Einträge bzw. die <code>commands.conf</code> des VDR gäbe es <code>~frontend-dbus-send start_desktop NAME_DER_DESKTOP_DATEI</code> (alternativ kann man auch frontend-dbus-send switchto NAME_DER_DESKTOP_DATEI nutzen, dafür kann man auch die in der Konfigurationsdatei <code>/etc/yavdr-frontend/config.yml</code> im Abschnitt Applications definierten besonderen Namen wie &bdquo;vdr&ldquo;, &bdquo;mediacenter&ldquo;, &bdquo;browser&ldquo; usw. nutzen), wenn man mit einer Taste auf der Fernbedienung zwischen einer Anwendung und dem VDR-Frontend hin- und herschalten können will, wäre z.B. <code>frontend-dbus-send switchbetween vdr NAME_DER_DESKTOP_DATEI</code> eine Möglichkeit.
</p>

<p>
Ruft man <code>frontend-dbus-send</code> ohne Argumente auf, zeigt es eine XML-Beschreibung der DBUS-API.
</p>
</div>
</div>
</div>

<div id="outline-container-dual-screen" class="outline-3">
<h3 id="dual-screen"><span class="section-number-3">5.4.</span> Mehrere Bildschirme</h3>
<div class="outline-text-3" id="text-dual-screen">
<p>
yavdr-ansible unterstützt die Ausgabe auf zwei Bildschirmen. Der primäre Bildschirm stellt standardmäßig das VDR-Frontend, KODI und andere Programme dar. Ist ein sekundärer Bildschirm erkannt worden, wird dieser standardmäßig für die Darstellung von osd2web genutzt.
</p>

<p>
Man kann die Ausgabe auf primärem und sekundärem Monitor vertauschen, indem man das Skript <code>/var/lib/vdr/bin/switch-displays</code> innerhalb der User Session (z.B. über irexec) oder als root mit korrekt gesetzter <code>DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/666</code> aufruft.
</p>
</div>

<div id="outline-container-osd2web-dualscreen" class="outline-4">
<h4 id="osd2web-dualscreen"><span class="section-number-4">5.4.1.</span> osd2web auf zweitem Monitor</h4>
<div class="outline-text-4" id="text-osd2web-dualscreen">
<p>
Wenn ein <code>DISPLAY</code> mit der Adresse <code>:0.1</code> existiert (das ist vorhanden, wenn das Ansible-Playbook einen zweiten Monitor erkannt und konfiguriert hat), wird auf diesem ein Webbrowser (Voreinstellung: <code>kiosk-browser</code>) zur Darstellung der von <code>osd2web</code> bereitgestellten Webseite angezeigt.
</p>

<p>
Die dafür zuständige Systemd-Unit ist <code>/var/lib/vdr/.config/systemd/user/osd2web.service</code>. Die in dieser Unit genutzten Vorgabewerte für die Variablen <code>url</code> und <code>browser</code> können durch das Anlegen der Datei <code>/var/lib/vdr/.config/osd2web/config</code> mit den gewünschten Variablenzuweisungen übersteuert werden.
</p>

<p>
Um z.B. statt dem vorkonfigurierten anthraize-Theme das bluecd-Theme zu nutzen, könnte man die Variable <code>url</code> so setzen (<code>?onlyView=1</code> sorgt dafür, dass die Steuerungselemente ausgeblendet werden):
</p>
<div class="org-src-container">
<pre class="src src-shell"><span class="org-variable-name">url</span>=<span class="org-string">"http://192.168.1.30:4444/skins/horchiTft/index.html?theme=bluecd?onlyView=1"</span>
</pre>
</div>

<p>
Das Plugin ist auf Port <code>4444</code> erreichbar, dort werden auch die verfügbaren Themes mit den zugehörigen URLs gelistet.
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-vdr" class="outline-2">
<h2 id="vdr"><span class="section-number-2">6.</span> VDR</h2>
<div class="outline-text-2" id="text-vdr">
</div>
<div id="outline-container-vdr-controls" class="outline-3">
<h3 id="vdr-controls"><span class="section-number-3">6.1.</span> Bedienung des VDR</h3>
<div class="outline-text-3" id="text-vdr-controls">
<p>
Um die grundlegende Bedienung und die Konfiguration des VDR über das OSD werden im Benutzerhandbuch beschrieben:
</p>

<p>
<a href="http://vdr-wiki.de/wiki/index.php/Benutzerhandbuch">http://vdr-wiki.de/wiki/index.php/Benutzerhandbuch</a>
</p>

<p>
Die standardmäßig über die <code>remote.conf</code> des VDR vorkonfigurierte Tastenbelegung für die Tastatur sieht so aus:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Tabelle 2</span> Tastenbelegung</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Taste</th>
<th scope="col" class="org-left">Funktion</th>
<th scope="col" class="org-left">Anmerkung</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Pos1/Home/Tab</td>
<td class="org-left">Menü</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Backspace</td>
<td class="org-left">Exit</td>
<td class="org-left">Kehrt zum Übergeordneten Menü zurück</td>
</tr>

<tr>
<td class="org-left">Enter</td>
<td class="org-left">Ok</td>
<td class="org-left">Außerhalb des OSD-Menüs: kleine Info-Anzeige</td>
</tr>

<tr>
<td class="org-left">Pfeil Auf</td>
<td class="org-left">Nach oben</td>
<td class="org-left">Außerhalb des OSD-Menüs: Kanal hoch</td>
</tr>

<tr>
<td class="org-left">Pfeil Ab</td>
<td class="org-left">Nach unten</td>
<td class="org-left">Außerhalb des OSD-Menüs: Kanal runter</td>
</tr>

<tr>
<td class="org-left">Pfeil links</td>
<td class="org-left">Nach links</td>
<td class="org-left">Außerhalb des OSD-Menüs: Wechsel der Kanalgruppe</td>
</tr>

<tr>
<td class="org-left">Pfeil rechts</td>
<td class="org-left">nach rechts</td>
<td class="org-left">Außerhalb des OSD-Menüs: Wechsel der Kanalgruppe</td>
</tr>

<tr>
<td class="org-left">Ende</td>
<td class="org-left">Info</td>
<td class="org-left">Öffnet die Informationen zu einem Listenelement</td>
</tr>

<tr>
<td class="org-left">Pause</td>
<td class="org-left">Power</td>
<td class="org-left">VDR herunterfahren</td>
</tr>

<tr>
<td class="org-left">F1</td>
<td class="org-left">Rot</td>
<td class="org-left">Belegung wird bei aktivem OSD eingeblendet.</td>
</tr>

<tr>
<td class="org-left">F2</td>
<td class="org-left">Grün</td>
<td class="org-left">Belegung wird bei aktivem OSD eingeblendet.</td>
</tr>

<tr>
<td class="org-left">F3</td>
<td class="org-left">Gelb</td>
<td class="org-left">Belegung wird bei aktivem OSD eingeblendet.</td>
</tr>

<tr>
<td class="org-left">F4</td>
<td class="org-left">Blau</td>
<td class="org-left">Belegung wird bei aktivem OSD eingeblendet.</td>
</tr>

<tr>
<td class="org-left">F5</td>
<td class="org-left">Zurückspulen</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">F6</td>
<td class="org-left">Vorspulen</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">F10</td>
<td class="org-left">Mute</td>
<td class="org-left">Schaltet den Ton aus oder ein</td>
</tr>

<tr>
<td class="org-left">F11</td>
<td class="org-left">Leiser</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">F12</td>
<td class="org-left">Lauter</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Zifferntasten</td>
<td class="org-left">Ziffern 0-9</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-vdr-output-plugins" class="outline-3">
<h3 id="vdr-output-plugins"><span class="section-number-3">6.2.</span> Unterstützte Ausgabeplugins</h3>
<div class="outline-text-3" id="text-vdr-output-plugins">
<p>
Da das originale softhddevice nicht mehr weiterentwickelt zu werden scheint, gibt es mittlerweile eine Reihe von Ablegern, die je nach Einsatzszenario mehr oder weniger gut geeignet sind.
Aktuell sind die folgenden Pakete für Ausgabeplugins für Ubuntu bionic verfügbar, die vom yavdr-frontend automatisch erkannt werden:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Tabelle 3</span> Verfügbare Ausgabeplugins unter Ubuntu 18.04</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Paketname</th>
<th scope="col" class="org-left">VDPAU</th>
<th scope="col" class="org-left">Cuvid</th>
<th scope="col" class="org-left">VAAPI</th>
<th scope="col" class="org-left">HEVC</th>
<th scope="col" class="org-right">ffmpeg</th>
<th scope="col" class="org-left">Kommentar</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">vdr-plugin-softhddevice-vpp</td>
<td class="org-left">Ja</td>
<td class="org-left">Nein</td>
<td class="org-left">Ja</td>
<td class="org-left">Ja (Software)</td>
<td class="org-right">3.4</td>
<td class="org-left">Fork von softhddevice, unterstützt Ausgabe über VDPAU und VAAPI</td>
</tr>

<tr>
<td class="org-left">vdr-plugin-softhddevice-vdpau-hevc</td>
<td class="org-left">Ja</td>
<td class="org-left">Nein</td>
<td class="org-left">Ja</td>
<td class="org-left">Ja (VAAPI, VDPAU)</td>
<td class="org-right">3.3</td>
<td class="org-left">Wie softhddevice-vpp, aber gegen ffmpeg 3.3 gebaut</td>
</tr>

<tr>
<td class="org-left">vdr-plugin-softhddevice-openglosd</td>
<td class="org-left">Ja</td>
<td class="org-left">Nein</td>
<td class="org-left">Nein</td>
<td class="org-left">Nein</td>
<td class="org-right">3.4</td>
<td class="org-left">Fork von softhddevice mit hardwarebeschleunigtem OSD</td>
</tr>

<tr>
<td class="org-left">vdr-plugin-softhddevice-openglosd-ffmpeg-2.8</td>
<td class="org-left">Ja</td>
<td class="org-left">Nein</td>
<td class="org-left">Nein</td>
<td class="org-left">Nein</td>
<td class="org-right">2.8</td>
<td class="org-left">wie softhddevice-openglosd, scheint mit ffmpeg 2.8 stabiler zu laufen</td>
</tr>

<tr>
<td class="org-left">vdr-plugin-softhddevice</td>
<td class="org-left">Ja</td>
<td class="org-left">Nein</td>
<td class="org-left">Ja</td>
<td class="org-left">Ja (Software)</td>
<td class="org-right">3.4</td>
<td class="org-left">Für neuere ffmpeg-Versionen angepasste Weiterentwicklung von softhddevice-vpp</td>
</tr>

<tr>
<td class="org-left">vdr-plugin-softhddevice</td>
<td class="org-left">Ja</td>
<td class="org-left">Ja</td>
<td class="org-left">Ja</td>
<td class="org-left">Ja (CUVID, VAAPI?)</td>
<td class="org-right">4.2.1</td>
<td class="org-left">mit ppa:seahawk1986-hotmail/vdr-2.4.1 und ppa:seahawk1986-hotmail/softhdvaapi</td>
</tr>

<tr>
<td class="org-left">vdr-plugin-softhdvaapi</td>
<td class="org-left">Nein</td>
<td class="org-left">Nein</td>
<td class="org-left">Ja</td>
<td class="org-left">Ja (VAAPI)</td>
<td class="org-right">4.2.1</td>
<td class="org-left">mit ppa:seahawk1986-hotmail/vdr-2.4.1 und ppa:seahawk1986-hotmail/softhdvaapi</td>
</tr>

<tr>
<td class="org-left">vdr-plugin-softhddrm</td>
<td class="org-left">Nein</td>
<td class="org-left">Nein</td>
<td class="org-left">Ja</td>
<td class="org-left">Ja (VAAPI)</td>
<td class="org-right">4.2.1</td>
<td class="org-left">mit ppa:seahawk1986-hotmail/vdr-2.4.1 und ppa:seahawk1986-hotmail/softhdvaapi</td>
</tr>

<tr>
<td class="org-left">vdr-plugin-softhdcuvid</td>
<td class="org-left">Nein</td>
<td class="org-left">Ja</td>
<td class="org-left">Ja</td>
<td class="org-left">Ja (CUVID)</td>
<td class="org-right">4.2.1</td>
<td class="org-left"><a href="https://www.vdr-portal.de/forum/index.php?thread/132253-anleitung-f%C3%BCr-softhdcuvid-mit-libplacebo/">Anleitung für softhdcuvid mit libplacebo</a></td>
</tr>

<tr>
<td class="org-left">vdr-plugin-softhddevice-ffmpeg-2.8</td>
<td class="org-left">Ja</td>
<td class="org-left">Nein</td>
<td class="org-left">Nein</td>
<td class="org-left">Nein</td>
<td class="org-right">2.8</td>
<td class="org-left">originale Variante des softhddevice-Plugin, gegen ffmpeg 2.8 gebaut.</td>
</tr>

<tr>
<td class="org-left">vdr-plugin-vaapidevice</td>
<td class="org-left">Nein</td>
<td class="org-left">Nein</td>
<td class="org-left">Ja</td>
<td class="org-left">Ja (Software)</td>
<td class="org-right">3.3</td>
<td class="org-left">Auf VAAPI reduzierte Variante von softhddevice-vpp</td>
</tr>

<tr>
<td class="org-left">vdr-plugin-vaapidevice-hecv</td>
<td class="org-left">Nein</td>
<td class="org-left">Nein</td>
<td class="org-left">Ja</td>
<td class="org-left">Ja (VAAPI, VDPAU)</td>
<td class="org-right">3.3</td>
<td class="org-left">wie vaapidevice, gegen ffmpeg-3.3 gebaut</td>
</tr>

<tr>
<td class="org-left">vdr-plugin-softhdcuvid</td>
<td class="org-left">Ja</td>
<td class="org-left">Ja</td>
<td class="org-left">Nein</td>
<td class="org-left">Ja (CUVID)</td>
<td class="org-right">3.4</td>
<td class="org-left">Für Nvidia-Karten mit CUDA/CUVID Decoder (ab GT630 Kepler und höher)</td>
</tr>

<tr>
<td class="org-left">vdr-plugin-xineliboutput</td>
<td class="org-left">Ja</td>
<td class="org-left">Nein</td>
<td class="org-left">Ja</td>
<td class="org-left">Ja (Software)</td>
<td class="org-right">3.4</td>
<td class="org-left">Unterstützt VAAPI und VDPAU, läuft auch ohne Hardwarebeschleunigung in VMs</td>
</tr>
</tbody>
</table>
<p>
Für Ubuntu Focal sind nur noch Pakete mit Kompatibilität zu ffmpeg 2.8 und ffmpeg 4.2 in den Paketquellen:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Tabelle 4</span> Verfügbare Ausgabeplugins unter Ubuntu 20.04</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Paketname</th>
<th scope="col" class="org-left">VDPAU</th>
<th scope="col" class="org-left">CUVID</th>
<th scope="col" class="org-left">VAAPI</th>
<th scope="col" class="org-left">HEVC</th>
<th scope="col" class="org-right">ffmpeg</th>
<th scope="col" class="org-left">Kommentar</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">vdr-plugin-softhddevice</td>
<td class="org-left">Ja</td>
<td class="org-left">Nein</td>
<td class="org-left">Ja</td>
<td class="org-left">Ja (VDPAU, VAAPI)</td>
<td class="org-right">4.2</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">vdr-plugin-softhddevice-cuvid</td>
<td class="org-left">Ja</td>
<td class="org-left">Ja</td>
<td class="org-left">Ja</td>
<td class="org-left">Ja (CUVID, VDPAU, VAAPI)</td>
<td class="org-right">4.2</td>
<td class="org-left">mit cuvid-Unterstützung (muss mit dem Start-Argument <code>-v cuvid</code> aktiviert werden)</td>
</tr>

<tr>
<td class="org-left">vdr-plugin-softhddevice-ffmpeg-2.8</td>
<td class="org-left">Ja</td>
<td class="org-left">Nein</td>
<td class="org-left">Nein</td>
<td class="org-left">Nein</td>
<td class="org-right">2.8</td>
<td class="org-left">originale Variante des softhddevice-Plugin, gegen ffmpeg 2.8 gebaut.</td>
</tr>

<tr>
<td class="org-left">vdr-plugin-softhddevice-openglosd-ffmpeg-2.8</td>
<td class="org-left">Ja</td>
<td class="org-left">Nein</td>
<td class="org-left">Nein</td>
<td class="org-left">Nein</td>
<td class="org-right">2.8</td>
<td class="org-left">wie softhddevice-openglosd, scheint mit ffmpeg 2.8 stabiler zu laufen</td>
</tr>

<tr>
<td class="org-left">vdr-plugin-softhdvaapi</td>
<td class="org-left">Nein</td>
<td class="org-left">Nein</td>
<td class="org-left">Ja</td>
<td class="org-left">Ja (VAAPI)</td>
<td class="org-right">4.2</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">vdr-plugin-softhddrm</td>
<td class="org-left">Nein</td>
<td class="org-left">Nein</td>
<td class="org-left">Ja</td>
<td class="org-left">Ja (VAAPI)</td>
<td class="org-right">4.2</td>
<td class="org-left">funktioniert nur ohne X-Session</td>
</tr>

<tr>
<td class="org-left">vdr-plugin-softhdcuvid</td>
<td class="org-left">Ja</td>
<td class="org-left">Ja</td>
<td class="org-left">Nein</td>
<td class="org-left">Ja (CUVID)</td>
<td class="org-right">4.2</td>
<td class="org-left">Für Nvidia-Karten mit CUDA/CUVID Decoder (ab GT630 Kepler und höher)</td>
</tr>

<tr>
<td class="org-left">vdr-plugin-vaapidevice</td>
<td class="org-left">Nein</td>
<td class="org-left">Nein</td>
<td class="org-left">Ja</td>
<td class="org-left">Ja (VAAPI)</td>
<td class="org-right">4.2</td>
<td class="org-left">Auf VAAPI reduzierte Variante von softhddevice-vpp, seit längerem ungepflegt</td>
</tr>

<tr>
<td class="org-left">vdr-plugin-xineliboutput</td>
<td class="org-left">Ja</td>
<td class="org-left">Nein</td>
<td class="org-left">Ja</td>
<td class="org-left">Ja</td>
<td class="org-right">4.2</td>
<td class="org-left">Unterstützt VAAPI und VDPAU, läuft auch ohne Hardwarebeschleunigung in VMs</td>
</tr>
</tbody>
</table>
<p>
HEVC sollte mit Nvidia-GPUs ab der GTX 950/GT 1030 aufwärts und mit Intel IGPs ab der Skylake-Generation (mehr als 8-Bit pro Farbkanal erst ab Kabylake) funktionieren. Die Ausgabe ist bislang auf 8-Bit pro Farbkanal beschränkt.
</p>

<p>
Die Ausgabe mit 10 Bit pro Farbkanal scheint mit softhddrm in Verbindung mit einem gepatchten Kernel auf geeigneter Hardware grundsätzlich möglich zu sein: <a href="https://www.vdr-portal.de/forum/index.php?thread/132976-softhdcuvid-jetzt-mit-vaapi-und-hdr-support/&amp;postID=1320674#post1320674">Beschreibung von softhddrm (2019-12-10)</a> ff.
</p>
</div>
<div id="outline-container-org1491957" class="outline-4">
<h4 id="org1491957"><span class="section-number-4">6.2.1.</span> Bekannte Probleme bei den Ausgabeplugins:</h4>
<div class="outline-text-4" id="text-6-2-1">
<dl class="org-dl">
<dt>4k Auflösung</dt><dd>Darstellungsprobleme beim Skindesigner mit anderen Skins als metrix HD</dd>
<dt>softhddrm</dt><dd>Funktioniert nur ohne X-Server, Umschaltung zu anderen Programmen schwierig (<a href="https://www.vdr-portal.de/forum/index.php?thread/132976-softhdcuvid-jetzt-mit-vaapi-und-hdr-support/&amp;postID=1321463#post1321463">VDR muss wohl als root laufen, um das DRM-Device freigaben zu können</a>)</dd>
<dt>softhddevice-vpp</dt><dd>Farbfehldarstellung des OSD mit bestimmten Nvidia-Karten (z.B. GT630 mit Kepler Chipsatz)</dd>
<dt>VDPAU mit ffmpeg 3.4/3.3</dt><dd>bei SAT-Empfang in Verbindung Crashes auf bestimmten Sendern, in dem Fall eine der Varianten mit ffmpeg 2.8 verwenden.</dd>
<dt>VDPAU und VAAPI mit ffmpeg 3.4</dt><dd>keine Hardwarebeschleunigung für HEVC-Material, in dem Fall eine Variante mit ffmpeg 3.3 verwenden.</dd>
</dl>
</div>
</div>
</div>
<div id="outline-container-vdr-configuration" class="outline-3">
<h3 id="vdr-configuration"><span class="section-number-3">6.3.</span> Konfiguration des VDR</h3>
<div class="outline-text-3" id="text-vdr-configuration">
</div>
<div id="outline-container-vdr-environment-variables" class="outline-4">
<h4 id="vdr-environment-variables"><span class="section-number-4">6.3.1.</span> Umgebungsvariablen</h4>
<div class="outline-text-4" id="text-vdr-environment-variables">
<p>
Für den VDR und die von der Systemd-Unit genutzten Hilfsskripte können in der Konfigurationsdatei <code>/etc/default/vdr</code> Umgebungsvariablen gesetzt werden.
</p>
</div>
</div>
<div id="outline-container-vdr-start-arguments" class="outline-4">
<h4 id="vdr-start-arguments"><span class="section-number-4">6.3.2.</span> Startargumente</h4>
<div class="outline-text-4" id="text-vdr-start-arguments">
<p>
Wie schon bei yaVDR 0.6 wird weiterhin die ARGSDIR-Konfiguration genutzt. Wenn der VDR ohne Argumente gestartet wird, liest er beim Start alle Dateien mit der Endung <code>.conf</code> im Verzeichnis <code>/etc/vdr/conf.d/</code> ein.
</p>

<p>
Die Konfigurationsdateien nutzen eine vom <code>.ini</code>-Format gewohnte Syntax.
</p>
<ul class="org-ul">
<li>Zeilen, die mit einer Raute (<code>#</code>) beginnen, werden vom Parser ignoriert.</li>
<li>Jeder Abschnitt wird durch einen Begriff in eckigen Klammern eingeleitet, der angibt, wofür die Argumente in den nachfolgenden Zeilen gelten sollen. Um Startargumente für den VDR zu definieren schreibt man also <code>[vdr]</code> und für Plugins den Pluginnamen, z.B. <code>[softhddevice]</code> für das Softhddevice-Plugin.</li>
<li>In den folgenden Zeilen können dann Start-Argumente für den VDR bzw. das jeweilige Plugin übergeben werden.</li>
<li>Falls es mehrere Abschnitte gibt, die mit dem gleichen Begriff in eckigen Klammern eingeleitet werden, werden nur die Abschnitte für <code>[vdr]</code> zusammengefasst, bei Plugins wird die Konfiguration jeweils einzeln an den VDR übergeben, wodurch Plugins mehrfach mit unterschiedlichen Startargumenten geladen werden können. Plugins wie z.B. xineliboutput vertragen es nicht, wenn mehrere Instanzen geladen werden.</li>
</ul>

<p>
Um ein Plugin vom VDR laden zu lassen, genügt es seinen Namen in eckigen Klammern in einer Konfigurationsdatei abzulegen. Will man den Start verhindern, muss man dafür sorgen, dass der VDR den Eintrag nicht mehr einliest. Ein bequemes Werkzeug um Plugins zu (de-)aktivieren oder die Start-Argumente zu bearbeiten ist <a href="#vdrctl">vdrctl</a>.
</p>

<p>
Die Datei <code>/etc/vdr/conf.d/00_vdr.conf</code> enthält die vom Distributor vorgegebenen Start-Argumente für den VDR. Da alle Dateien in <code>/etc/</code>, die aus Paketen stammen, vom Paket-System als Konfigurationsdateien angesehen werden, können diese nach Wunsch verändert werden. Falls ein Paket beim Update eine davon abweichende Version mitbringt, erhält man eine Rückfrage, welche Version man übernehmen möchte.
</p>

<p>
Die Plugin-Pakete werden mit vorgefertigten Konfigurationsdateien ausgeliefert, die nach <code>/etc/vdr/conf.avail/&lt;plugin_name&gt;.conf</code> installiert und (falls der Distributor vorgibt, dass das Plugin automatisch nach der Installation aktiviert werden soll, wie es bei yaVDR der Fall ist) nach <code>/etc/vdr/conf.d/&lt;priorität&gt;-&lt;plugin_name&gt;.conf</code> verlinkt werden. Die standardmäßig gesetzte Priorität ist 50, ein abweichender Wert kann vom Distributor vorgegeben werden.
</p>

<p>
Alle Konfigurationsdateien in <i>etc/vdr/conf.d</i> werden nach Dateinamen sortiert interpretiert und somit die Plugins in der Reihenfolge der gesetzten Priorität geladen. Das Plugin mit der niedrigsten numerischen Priorität wird zuerst geladen und das Plugin mit der höchsten numerischen Priorität als letztes.
</p>

<p>
Mit dem folgenden Befehl kann man sich die vom VDR eingelesenen Startargumente anzeigen lassen:
</p>
<pre class="example" id="orgab42314">
$ vdr --showargs
</pre>
</div>
<ol class="org-ol">
<li><a id="vdrctl"></a>vdrctl<br />
<div class="outline-text-5" id="text-vdrctl">
<p>
vdrctl ist ein Hilfsprogramm, das die Verwaltung der Konfigurationsdateien für den VDR vereinfacht. Es kann die nötigen Symlinks anlegen bzw. entfernen und Konfigurationsdateien mit einem Editor öffnen.
</p>

<p>
Hier ein paar Beispiele zur Verwendung:
</p>
<pre class="example" id="org22d5338">
# Hilfe zu vdrctl anzeigen.
vdrctl -h

# Status aller verfügbaren Plugins und statischen Konfigurationdateien
$ vdrctl status

# Aktivierung eines Plugins.
$ sudo vdrctl enable streamdev-client

# Ein Plugin unter Angabe der Priorität aktivieren.
$ sudo vdrctl enable dynamite -p 90

# Aktivierung mehrerer Plugins.
$ sudo vdrctl enable streamdev-client vnsiserver

# Ein Plugin deaktivieren.
$ sudo vdrctl disable iptv

# Mehrerere Plugins deaktivieren.
$ sudo vdrctl disable streamdev-client streamdev-server iptv

# Bearbeiten der Konfiguration für ein Plugin.
$ sudo vdrctl edit imonlcd

# Bearbeiten der Konfiguration mit einem Wunsch-Editor (hier vim):
$ EDITOR=vim sudo vdrctl edit imonlcd
</pre>
</div>
</li>
</ol>
</div>
<div id="outline-container-vdr-shutdown" class="outline-4">
<h4 id="vdr-shutdown"><span class="section-number-4">6.3.3.</span> Shutdown</h4>
<div class="outline-text-4" id="text-vdr-shutdown">
</div>
<ol class="org-ol">
<li><a id="vdr-shutdown-hooks"></a>Shutdown-Hooks<br />
<div class="outline-text-5" id="text-vdr-shutdown-hooks">
<p>
Zusätzlich zu den im VDR verankerten Mechanismen um einen Shutdown zu verhindern (Benutzeraktivität, anstehender Timer, Plugins verhindern den Shutdown während gewisser Operationen) gibt es die Möglichkeit den Shutdown-Versuch durch Hook-Skripte in <code>/etc/vdr/shutdown-hooks/</code> (bzw. von Paketen abgelegte Skripte in <code>/usr/share/vdr/shutdown-hooks/</code>) abzubrechen, die über den <code>vdr-shutdown-wrapper</code> und das Skript <code>/usr/lib/vdr/vdr-shutdown</code> aufgerufen werden.
</p>
</div>
<ol class="org-ol">
<li><a id="org6752622"></a>vdr-addon-acpiwakeup<br />
<div class="outline-text-6" id="text-6-3-3-1-1">
<p>
Das Addon setzt über <code>/sys/class/rtc/rtc0/wakealarm</code> bzw. über einen anderen über die Umgebungsvariable <code>WAKEALARM</code> in <code>/etc/default/vdr</code> bzw. <code>/etc/vdr/vdr-addon-acpiwakeup.conf~</code> angegebenen RTC-kompatiblen Node die Aufweckzeit.
Einstellungen wie das regelmäßige Aufwecken des Rechners, wenn kein Timer definiert wurde können über die Konfigurationsdatei <code>/etc/vdr/vdr-addon-acpiwakeup.conf</code> vorgenommen werden.
</p>
</div>
</li>
<li><a id="orgf9c6b1d"></a>vdr-addon-lifeguard-ng<br />
<div class="outline-text-6" id="text-6-3-3-1-2">
<p>
Das lifeguard-ng Addon verhindert den Shutdown für konfigurierbare Shutdown-Hindernisse wie bestehende SSH-, NFS- und Samba-Verbindungen von Clients. Darüber hinaus lassen im Netzwerk aktive Hosts bzw. pingbare IP-Addressen sowie angemeldete Nutzer und bestehende TC/IP-Verbindungen als Abbruchkriterien für den Shutdown konfigurieren. Die Konfiguration erfolgt über die <code>/etc/lifeguard.conf</code>.
</p>
</div>
</li>
</ol>
</li>

<li><a id="vdr-prevent-shutdown"></a>Shutdown durch den VDR verhindern<br />
<div class="outline-text-5" id="text-vdr-prevent-shutdown">
</div>
<ol class="org-ol">
<li><a id="org95de543"></a>automatischen Shutdown bei Inaktivität verhindern<br />
<div class="outline-text-6" id="text-6-3-3-2-1">
<p>
Um zu verhindern, dass der VDR bei Inaktivität den Rechner herunter fährt, kann man die Option &bdquo;VDR ausschalten bei Inaktivität (min)&ldquo; auf den Wert <code>0</code> setzen. Alternativ bei gestopptem VDR in der <code>/var/lib/vdr/setup.conf</code> die Variable <code>MinUserInactivity = 0</code> setzen.
</p>
</div>
</li>
<li><a id="org8ad4895"></a>Shutdown-Befehl entfernen<br />
<div class="outline-text-6" id="text-6-3-3-2-2">
<p>
Will man den Shutdown durch den VDR generell unterbinden, kann man in der Datei <code>/etc/vdr/conf.d/00-vdr.conf</code> die Zeile mit dem Argument für den Shutdown-Befehl auskommentieren bzw. entfernen:
</p>
<div class="org-src-container">
<pre class="src src-conf"><span class="org-comment-delimiter">#</span><span class="org-comment">--shutdown=/usr/lib/vdr/vdr-shutdown-wrapper</span>
</pre>
</div>
</div>
</li>
</ol>
</li>
</ol>
</div>
<div id="outline-container-vdr-common-problems" class="outline-4">
<h4 id="vdr-common-problems"><span class="section-number-4">6.3.4.</span> Häufige Problemstellungen</h4>
<div class="outline-text-4" id="text-vdr-common-problems">
</div>
<ol class="org-ol">
<li><a id="await-dvb"></a>VDR startet, bevor die DVB-Karten initialisiert wurden<br />
<div class="outline-text-5" id="text-await-dvb">
<p>
Es gibt mehrere Ansätze das Problem in yaVDR anzugehen:
</p>
</div>
<ol class="org-ol">
<li><a id="wait-for-dvb"></a>Start des VDR verzögern<br />
<div class="outline-text-7" id="text-wait-for-dvb">
<p>
Die mitgelieferte Systemd-Unit <b>wait-for-dvb@.service</b> erlaubt es den VDR erst starten zu lassen, wenn die vorgegeben Tuner verfügbar sind.
Nach einem Timeout von 90 Sekunden startet der VDR trotzdem, wenn ein Tuner dann immer noch nicht aufgetaucht ist.
</p>

<p>
Wichtiger Hinweis für focal: Hier wird <code>wait-for-dvb@.service</code> vom Playbook (über die Rolle <code>vdr</code>) verwaltet. In der Variablen <code>wait_for_dvb_devices</code> kann eine Liste von Tunern angegeben werden, für die eine Instanz der Unit aktiviert werden soll. Für alle nicht in der Liste aufgeführten Adapter von 0 - <code>max_num_dvb_devices</code> (Vorgabewert: <code>16</code>) werden ggf. bereits aktivierte Instanzen der Unit deaktiviert.
</p>

<p>
Die Aktivierung der Unit muss für jeden gewünschten Tuner erfolgen - um z.B. auf <code>/dev/dvb/adapter0</code> zu warten:
</p>
<pre class="example" id="org0b6d8f9">
$ sudo systemctl enable wait-for-dvb@0.service
</pre>
<p>
Bei Systemen mit vielen Tunern kann man auch eine Shell Parameter Expansion nutzen, um die Unit für mehrere Tuner auf einmal zu aktivieren (hier z.B. für 8 Tuner):
</p>
<pre class="example" id="org89bbe07">
$ sudo systemctl enable wait-for-dvb@{0..7}.service
</pre>

<p>
Wenn Tuner ausgebaut/abgesteckt werden, sollte der dazugehörige Service wieder deaktiviert werden - hier z.B. für das Gerät <code>/dev/dvb/adapter7</code>:
</p>
<pre class="example" id="orgb181b1f">
$ sudo systemctl disable wait-for-dvb@7.service
</pre>
<p>
Wichtig: das funktioniert nur für Tuner, für die udev-Events ausgelöst werden, für Sundtek-Empfänger bitte das Vorgehen in <a href="#sundtek-drivers">Sundtek Treiber</a> beachten!
</p>
</div>
</li>
<li><a id="vdr-plugin-dynamite"></a>dynamite-Plugin<br />
<div class="outline-text-7" id="text-vdr-plugin-dynamite">
<p>
Das dynamite-Plugin bindet DVB-Karten nachträglich automatisch ein, sobald sie verfügbar sind (leider gibt es Inkompatibilitäten mit anderen Plugins wie z.B. pvrinput)
</p>
</div>
</li>
</ol>
</li>
<li><a id="vdr-does-not-start"></a>VDR startet nicht<br />
<div class="outline-text-5" id="text-vdr-does-not-start">
<p>
Zu den häufigsten Problemursachen (ein Blick in die Logdateien hilft, um die Ursache zu erkennen) gehören:
</p>
<ul class="org-ul">
<li>das Aufnahmeverzeichnis existiert nicht</li>
<li>der User vdr hat keinen vollen Zugriff auf das Aufnahmeverzeichnis (Lese-, Schreib- und Ausführungsrechte nötig)</li>
<li>Es wurde ein Plugin von Hand gebaut, das nach einem Update nicht mehr zur ABI-Version des VDR passt oder dessen Symbole nicht erfolgreich gelinkt werden konnten</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-orgbd4f108" class="outline-2">
<h2 id="orgbd4f108"><span class="section-number-2">7.</span> KODI</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-orgd353696" class="outline-4">
<h4 id="orgd353696"><span class="section-number-4">7.0.1.</span> Fernsehen mit VNSI</h4>
<div class="outline-text-4" id="text-7-0-1">
<p>
Pakete <code>vdr-plugin-vnsiserver</code> und <code>kodi-pvr-vdr-vnsi</code> installieren, dann in KODI in den Addon-Einstellungen das PVR-Addon VNSI aktivieren.
</p>
</div>
</div>
</div>
<div id="outline-container-epgd" class="outline-2">
<h2 id="epgd"><span class="section-number-2">8.</span> vdr-epg-daemon</h2>
<div class="outline-text-2" id="text-epgd">
</div>
<div id="outline-container-org69d52ee" class="outline-3">
<h3 id="org69d52ee"><span class="section-number-3">8.1.</span> Häufige Probleme</h3>
<div class="outline-text-3" id="text-8-1">
</div>
<div id="outline-container-org087c8e5" class="outline-4">
<h4 id="org087c8e5"><span class="section-number-4">8.1.1.</span> epgd startet nicht</h4>
<div class="outline-text-4" id="text-8-1-1">
</div>
<ol class="org-ol">
<li><a id="org790c38a"></a>Fehlende Locale<br />
<div class="outline-text-5" id="text-8-1-1-1">
<p>
Die UDF (user-defined function) <code>epglv</code> für MariaDB benötigt die Locale <code>de_DE.UTF-8</code> - wenn diese fehlt, gibt es eine Fehlermeldung wie diese im Log:
</p>
<pre class="example" id="org52ec7aa">
May  2 11:19:01 hdvdr epgd: SQL-Error in 'select epglv('123', '123')' - Can't initialize function 'epglv'; EPGLV() failed to change locale (1123)
May  2 11:19:01 hdvdr epgd: SQL-Error in 'select epglvr('123', '123')' - Can't initialize function 'epglvr'; EPGLV() failed to change locale (1123)
</pre>

<p>
Abhilfe schaft es mittels <code>sudo dpkg-reconfigure locales</code> dafür zu sorgen, dass die Locales für <code>de_DE.UTF-8</code> erzeugt werden.
</p>

<p>
Nach einer &bdquo;normalen&ldquo; Ubuntu Server Installation mit deutscher Sprache sehen die für debconf gesetzten Einstellungen so aus:
</p>
<pre class="example" id="orgdfb7e8a">
$ sudo debconf-show locales
 * locales/locales_to_be_generated: de_DE.UTF-8 UTF-8, en_US.UTF-8 UTF-8
 * locales/default_environment_locale: de_DE.UTF-8
</pre>
<p>
Nach Änderungen an den Locale-Einstellungen sollte der Rechner neu gestartet werden, damit garantiert ist, dass alle Prozesse die Änderungen mitbekommen.
</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-sundtek-drivers" class="outline-2">
<h2 id="sundtek-drivers"><span class="section-number-2">9.</span> Sundtek Treiber</h2>
<div class="outline-text-2" id="text-sundtek-drivers">
<p>
Für die Nutzung von Sundtek DVB-Tunern muss das Paket <code>dvb-driver-sundtek</code> installiert werden. Die Ansible-Rolle <a href="#install-sundtek-role">install-sundtek</a> kann einem die hier beschriebene Konfigurationsschritte abnehmen.
</p>

<p>
<code>LD_PRELOAD=/opt/lib/libmediaclient.so</code> muss für alle Programme als Umgebungsvariable gesetzt werden, die die Sundtek-Geräte nutzen sollen (wie z.B. <code>w_scan</code>).
</p>

<p>
Damit der VDR die vom Sundtek mediasrv erstellten Devices nutzen kann, muss die Unit <code>vdr.service</code> mit dem folgendem Snippet erweitert werden:
</p>
<div class="org-src-container">
<pre class="src src-systemd"><span class="org-comment-delimiter"># </span><span class="org-comment">/etc/systemd/system/vdr.service.d/sundtek.conf</span>
<span class="org-type">[Service]</span>
<span class="org-keyword">Environment</span>=LD_PRELOAD=/opt/lib/libmediaclient.so
</pre>
</div>


<p>
Prinzpiell gibt es zwei Möglichkeiten die Tuner mit dem VDR zu nutzen, die in den folgenden Abschnitten genauer erläutert werden:
</p>
<ul class="org-ul">
<li><a href="#sundtek-delay-vdr-start">Start des VDR verzögern, bis alle Tuner intialisiert wurden</a></li>
<li><a href="#sundtek-dynamic-includes">Sundtek-Tuner automatisch zur Laufzeit des VDR einbinden lassen</a></li>
</ul>
</div>

<div id="outline-container-sundtek-delay-vdr-start" class="outline-3">
<h3 id="sundtek-delay-vdr-start"><span class="section-number-3">9.1.</span> Start des VDR verzögern, bis alle Tuner initialisiert wurden</h3>
<div class="outline-text-3" id="text-sundtek-delay-vdr-start">
<div class="org-src-container">
<pre class="src src-systemd"><span class="org-comment-delimiter"># </span><span class="org-comment">/etc/systemd/system/sundtek.service</span>
<span class="org-type">[Unit]</span>
<span class="org-keyword">Description</span>=Sundtek mediasrv
<span class="org-comment-delimiter">#</span><span class="org-comment">After=network-online.target</span>
<span class="org-keyword">Before</span>=vdr.service

<span class="org-type">[Service]</span>
<span class="org-keyword">Type</span>=<span class="org-builtin">forking</span>
<span class="org-keyword">ExecStart</span>=/opt/bin/mediasrv -d --pluginpath=/opt/bin --wait-for-devices
<span class="org-keyword">ExecStop</span>=/opt/bin/mediaclient --shutdown
<span class="org-keyword">Restart</span>=<span class="org-builtin">on-failure</span>

<span class="org-type">[Install]</span>
<span class="org-keyword">WantedBy</span>=multi-user.target
</pre>
</div>

<p>
Die Unit kann dann mit dem folgenden Befehl aktiviert werden, damit sie beim Systemstart automatisch ausgeführt wird:
</p>
<pre class="example" id="org950cb95">
systemctl enable sundtek.service
</pre>

<p>
Falls man Netzwerktuner über die <code>/etc/sundtek.conf</code> einbinden will, muss die Zeile <code>After=network-online.service</code> einkommentiert werden und außerdem muss sichergestellt sein, dass der Server dauerhaft erreichbar ist.
</p>

<p>
Nachteil dieser Variante ist, dass man Sundtek-Tuner zur Laufzeit des VDR nicht hinzufügen bzw. entfernen kann, dafür funktionieren Plugins, die voraussetzen, dass bestimmte Geräteknoten für die DVB-Geräte existieren.
</p>
</div>
</div>

<div id="outline-container-sundtek-dynamic-includes" class="outline-3">
<h3 id="sundtek-dynamic-includes"><span class="section-number-3">9.2.</span> Sundtek-Tuner automatisch zur Laufzeit des VDR einbinden lassen</h3>
<div class="outline-text-3" id="text-sundtek-dynamic-includes">
<p>
Um lokal angeschlossene Tuner automatisch ein- bzw. aushängen zu lassen müssen die Pakete <code>vdr-plugin-dynamite</code> und <code>vdr-plugin-sundtek</code> installiert werden.
</p>

<p>
Das <code>vdr-plugin-sundtek</code> reagiert auf Meldungen des mediasrv für neu hinzugefügte bzw. abgesteckte Sundtek-Tuner und bindet diese über das <code>vdr-plugin-dynamite</code> ein bzw. hängt sie aus.
</p>

<p>
Das automatische Einbinden von über Avahi angekündigten Sundtek-Tunern im Netzwerk ist aktuell noch nicht möglich, da der von früheren yaVDR-Versionen bekannte <code>avahi-sundtek-mounter</code> erst noch angepasst werden muss.
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Autor: Alexander Grothe (seahawk1986)</p>
<p class="date">Created: 2021-10-01 Fr 18:08</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
